<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Ben Baldwin (learnr by Tan Ho)" />


<meta name="progressive" content="false" />
<meta name="allow-skip" content="false" />

<title>Beginner’s Guide to nflfastR</title>


<!-- highlightjs -->
<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>

<!-- taken from https://github.com/rstudio/rmarkdown/blob/67b7f5fc779e4cfdfd0f021d3d7745b6b6e17149/inst/rmd/h/default.html#L296-L362 -->
<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>
<!-- end tabsets -->


<link rel="stylesheet" href="css\styles.css" type="text/css" />

</head>

<body>



<div class="pageContent band">
<div class="bandContent page">

<div class="topics">

<div id="section-introduction" class="section level2">
<h2>Introduction</h2>
<p>The following guide will assume you have R installed. I also highly recommend working in RStudio. If you need help getting those installed or are unfamiliar with how RStudio is laid out, <a href="https://github.com/leesharpe/nfldata/blob/master/RSTUDIO-INTRO.md#r-and-rstudio-introduction">please see this section of Lee Sharpe’s guide</a>.</p>
<p>A quick word if you’re new to programming: all of this is happening in R. Obviously, you need to install R on your computer to do any of this. Make sure you save what you’re doing in a script (in RStudio, File –&gt; New File –&gt; R script) so you can save your work and run multiple lines of code at once. To run code from a script, highlight what you want, and press control + enter or press the Run button in the top of the editor (see Lee’s guide). If you don’t highlight anything and press control + enter, the currently selected line will run. As you go through your R journey, you might get stuck and have to google a bunch of things, but that’s totally okay and normal. That’s how I got started!</p>
</div>
<div id="section-setup" class="section level2">
<h2>Setup</h2>
<p>First, you need to install the magic packages. You only need to run this step once on a given computer. For these you can just type them into the RStudio console (look for the Console pane in RStudio) directly since you’re never going to be doing this again.</p>
<div id="section-install-packages" class="section level3">
<h3>Install packages</h3>
<pre class="r"><code>install.packages(&quot;tidyverse&quot;)
install.packages(&quot;ggrepel&quot;)
install.packages(&quot;ggimage&quot;)
#needed to install `nflfastR`
install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;mrcaseb/nflfastR&quot;)</code></pre>
</div>
<div id="section-load-packages" class="section level3">
<h3>Load packages</h3>
<p>Okay, now here’s the stuff you’re going to want to start putting into your R script. The following loads <code>tidyverse</code>, which contains a lot of helper functions for working with data, and <code>ggrepel</code> and <code>ggimage</code> for making figures, along with <code>nflfastR</code>.</p>
<pre class="r"><code>library(tidyverse)
library(ggrepel)
library(ggimage)
library(nflfastR)</code></pre>
<p>This one is optional but makes R prefer not to display numbers in scientific notation, which I find very annoying:</p>
<pre class="r"><code>options(scipen = 9999)</code></pre>
</div>
<div id="section-load-data" class="section level3">
<h3>Load data</h3>
<p>This will load the full play by play for the 2019 season (including playoffs). We’ll get to how to get more seasons later. Note that this is not actually using the <code>nflfastR</code> package, but downloading pre-cleaned data from its data repository, which is much faster.</p>
<pre class="r"><code>data &lt;- readRDS(url(&#39;https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_2019.rds&#39;))</code></pre>
</div>
</div>
<div id="section-basics-how-to-look-at-your-data" class="section level2">
<h2>Basics: how to look at your data</h2>
<div id="section-dimensions" class="section level3">
<h3>Dimensions</h3>
<p>Before moving forward, here are a few ways to get a sense of what’s in a dataframe. We can check the <strong>dim</strong>ensions of the data, and this tells us that there are 48,034 rows (i.e., plays) in the data and 322 columns (variables):</p>
<pre class="r"><code>dim(data)
#&gt; [1] 48034   322</code></pre>
<p><code>str</code> displays the <strong>str</strong>ucture of the dataframe:</p>
<pre class="r"><code>str(data[1:10])
#&gt; tibble [48,034 x 10] (S3: tbl_df/tbl/data.frame)
#&gt;  $ play_id      : num [1:48034] 1 36 51 79 100 121 148 185 214 239 ...
#&gt;  $ game_id      : chr [1:48034] &quot;2019_01_ATL_MIN&quot; &quot;2019_01_ATL_MIN&quot; &quot;2019_01_ATL_MIN&quot; &quot;2019_01_ATL_MIN&quot; ...
#&gt;  $ home_team    : chr [1:48034] &quot;MIN&quot; &quot;MIN&quot; &quot;MIN&quot; &quot;MIN&quot; ...
#&gt;  $ away_team    : chr [1:48034] &quot;ATL&quot; &quot;ATL&quot; &quot;ATL&quot; &quot;ATL&quot; ...
#&gt;  $ season_type  : chr [1:48034] &quot;REG&quot; &quot;REG&quot; &quot;REG&quot; &quot;REG&quot; ...
#&gt;  $ week         : int [1:48034] 1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ posteam      : chr [1:48034] NA &quot;ATL&quot; &quot;ATL&quot; &quot;ATL&quot; ...
#&gt;  $ posteam_type : chr [1:48034] NA &quot;away&quot; &quot;away&quot; &quot;away&quot; ...
#&gt;  $ defteam      : chr [1:48034] NA &quot;MIN&quot; &quot;MIN&quot; &quot;MIN&quot; ...
#&gt;  $ side_of_field: chr [1:48034] NA &quot;MIN&quot; &quot;ATL&quot; &quot;ATL&quot; ...</code></pre>
<p>In the above, I’ve added in the <code>[1:10]</code>, which selects only the first 10 columns, otherwise the list is extremely long (remember from above that there are 322 columns!).</p>
</div>
<div id="section-variable-names" class="section level3">
<h3>Variable names</h3>
<p>Another very useful command is to get the <code>names</code> of the variables in the data:</p>
<pre class="r"><code>names(data)
#&gt;   [1] &quot;play_id&quot;                             
#&gt;   [2] &quot;game_id&quot;                             
#&gt;   [3] &quot;home_team&quot;                           
#&gt;   [4] &quot;away_team&quot;                           
#&gt;   [5] &quot;season_type&quot;                         
#&gt;   [6] &quot;week&quot;                                
#&gt;   [7] &quot;posteam&quot;                             
#&gt;   [8] &quot;posteam_type&quot;                        
#&gt;   [9] &quot;defteam&quot;                             
#&gt;  [10] &quot;side_of_field&quot;                       
#&gt;  [11] &quot;yardline_100&quot;                        
#&gt;  [12] &quot;game_date&quot;                           
#&gt;  [13] &quot;quarter_seconds_remaining&quot;           
#&gt;  [14] &quot;half_seconds_remaining&quot;              
#&gt;  [15] &quot;game_seconds_remaining&quot;              
#&gt;  [16] &quot;game_half&quot;                           
#&gt;  [17] &quot;quarter_end&quot;                         
#&gt;  [18] &quot;drive&quot;                               
#&gt;  [19] &quot;sp&quot;                                  
#&gt;  [20] &quot;qtr&quot;                                 
#&gt;  [21] &quot;down&quot;                                
#&gt;  [22] &quot;goal_to_go&quot;                          
#&gt;  [23] &quot;time&quot;                                
#&gt;  [24] &quot;yrdln&quot;                               
#&gt;  [25] &quot;ydstogo&quot;                             
#&gt;  [26] &quot;ydsnet&quot;                              
#&gt;  [27] &quot;desc&quot;                                
#&gt;  [28] &quot;play_type&quot;                           
#&gt;  [29] &quot;yards_gained&quot;                        
#&gt;  [30] &quot;shotgun&quot;                             
#&gt;  [31] &quot;no_huddle&quot;                           
#&gt;  [32] &quot;qb_dropback&quot;                         
#&gt;  [33] &quot;qb_kneel&quot;                            
#&gt;  [34] &quot;qb_spike&quot;                            
#&gt;  [35] &quot;qb_scramble&quot;                         
#&gt;  [36] &quot;pass_length&quot;                         
#&gt;  [37] &quot;pass_location&quot;                       
#&gt;  [38] &quot;air_yards&quot;                           
#&gt;  [39] &quot;yards_after_catch&quot;                   
#&gt;  [40] &quot;run_location&quot;                        
#&gt;  [41] &quot;run_gap&quot;                             
#&gt;  [42] &quot;field_goal_result&quot;                   
#&gt;  [43] &quot;kick_distance&quot;                       
#&gt;  [44] &quot;extra_point_result&quot;                  
#&gt;  [45] &quot;two_point_conv_result&quot;               
#&gt;  [46] &quot;home_timeouts_remaining&quot;             
#&gt;  [47] &quot;away_timeouts_remaining&quot;             
#&gt;  [48] &quot;timeout&quot;                             
#&gt;  [49] &quot;timeout_team&quot;                        
#&gt;  [50] &quot;td_team&quot;                             
#&gt;  [51] &quot;posteam_timeouts_remaining&quot;          
#&gt;  [52] &quot;defteam_timeouts_remaining&quot;          
#&gt;  [53] &quot;total_home_score&quot;                    
#&gt;  [54] &quot;total_away_score&quot;                    
#&gt;  [55] &quot;posteam_score&quot;                       
#&gt;  [56] &quot;defteam_score&quot;                       
#&gt;  [57] &quot;score_differential&quot;                  
#&gt;  [58] &quot;posteam_score_post&quot;                  
#&gt;  [59] &quot;defteam_score_post&quot;                  
#&gt;  [60] &quot;score_differential_post&quot;             
#&gt;  [61] &quot;no_score_prob&quot;                       
#&gt;  [62] &quot;opp_fg_prob&quot;                         
#&gt;  [63] &quot;opp_safety_prob&quot;                     
#&gt;  [64] &quot;opp_td_prob&quot;                         
#&gt;  [65] &quot;fg_prob&quot;                             
#&gt;  [66] &quot;safety_prob&quot;                         
#&gt;  [67] &quot;td_prob&quot;                             
#&gt;  [68] &quot;extra_point_prob&quot;                    
#&gt;  [69] &quot;two_point_conversion_prob&quot;           
#&gt;  [70] &quot;ep&quot;                                  
#&gt;  [71] &quot;epa&quot;                                 
#&gt;  [72] &quot;total_home_epa&quot;                      
#&gt;  [73] &quot;total_away_epa&quot;                      
#&gt;  [74] &quot;total_home_rush_epa&quot;                 
#&gt;  [75] &quot;total_away_rush_epa&quot;                 
#&gt;  [76] &quot;total_home_pass_epa&quot;                 
#&gt;  [77] &quot;total_away_pass_epa&quot;                 
#&gt;  [78] &quot;air_epa&quot;                             
#&gt;  [79] &quot;yac_epa&quot;                             
#&gt;  [80] &quot;comp_air_epa&quot;                        
#&gt;  [81] &quot;comp_yac_epa&quot;                        
#&gt;  [82] &quot;total_home_comp_air_epa&quot;             
#&gt;  [83] &quot;total_away_comp_air_epa&quot;             
#&gt;  [84] &quot;total_home_comp_yac_epa&quot;             
#&gt;  [85] &quot;total_away_comp_yac_epa&quot;             
#&gt;  [86] &quot;total_home_raw_air_epa&quot;              
#&gt;  [87] &quot;total_away_raw_air_epa&quot;              
#&gt;  [88] &quot;total_home_raw_yac_epa&quot;              
#&gt;  [89] &quot;total_away_raw_yac_epa&quot;              
#&gt;  [90] &quot;wp&quot;                                  
#&gt;  [91] &quot;def_wp&quot;                              
#&gt;  [92] &quot;home_wp&quot;                             
#&gt;  [93] &quot;away_wp&quot;                             
#&gt;  [94] &quot;wpa&quot;                                 
#&gt;  [95] &quot;home_wp_post&quot;                        
#&gt;  [96] &quot;away_wp_post&quot;                        
#&gt;  [97] &quot;vegas_wp&quot;                            
#&gt;  [98] &quot;vegas_home_wp&quot;                       
#&gt;  [99] &quot;total_home_rush_wpa&quot;                 
#&gt; [100] &quot;total_away_rush_wpa&quot;                 
#&gt; [101] &quot;total_home_pass_wpa&quot;                 
#&gt; [102] &quot;total_away_pass_wpa&quot;                 
#&gt; [103] &quot;air_wpa&quot;                             
#&gt; [104] &quot;yac_wpa&quot;                             
#&gt; [105] &quot;comp_air_wpa&quot;                        
#&gt; [106] &quot;comp_yac_wpa&quot;                        
#&gt; [107] &quot;total_home_comp_air_wpa&quot;             
#&gt; [108] &quot;total_away_comp_air_wpa&quot;             
#&gt; [109] &quot;total_home_comp_yac_wpa&quot;             
#&gt; [110] &quot;total_away_comp_yac_wpa&quot;             
#&gt; [111] &quot;total_home_raw_air_wpa&quot;              
#&gt; [112] &quot;total_away_raw_air_wpa&quot;              
#&gt; [113] &quot;total_home_raw_yac_wpa&quot;              
#&gt; [114] &quot;total_away_raw_yac_wpa&quot;              
#&gt; [115] &quot;punt_blocked&quot;                        
#&gt; [116] &quot;first_down_rush&quot;                     
#&gt; [117] &quot;first_down_pass&quot;                     
#&gt; [118] &quot;first_down_penalty&quot;                  
#&gt; [119] &quot;third_down_converted&quot;                
#&gt; [120] &quot;third_down_failed&quot;                   
#&gt; [121] &quot;fourth_down_converted&quot;               
#&gt; [122] &quot;fourth_down_failed&quot;                  
#&gt; [123] &quot;incomplete_pass&quot;                     
#&gt; [124] &quot;touchback&quot;                           
#&gt; [125] &quot;interception&quot;                        
#&gt; [126] &quot;punt_inside_twenty&quot;                  
#&gt; [127] &quot;punt_in_endzone&quot;                     
#&gt; [128] &quot;punt_out_of_bounds&quot;                  
#&gt; [129] &quot;punt_downed&quot;                         
#&gt; [130] &quot;punt_fair_catch&quot;                     
#&gt; [131] &quot;kickoff_inside_twenty&quot;               
#&gt; [132] &quot;kickoff_in_endzone&quot;                  
#&gt; [133] &quot;kickoff_out_of_bounds&quot;               
#&gt; [134] &quot;kickoff_downed&quot;                      
#&gt; [135] &quot;kickoff_fair_catch&quot;                  
#&gt; [136] &quot;fumble_forced&quot;                       
#&gt; [137] &quot;fumble_not_forced&quot;                   
#&gt; [138] &quot;fumble_out_of_bounds&quot;                
#&gt; [139] &quot;solo_tackle&quot;                         
#&gt; [140] &quot;safety&quot;                              
#&gt; [141] &quot;penalty&quot;                             
#&gt; [142] &quot;tackled_for_loss&quot;                    
#&gt; [143] &quot;fumble_lost&quot;                         
#&gt; [144] &quot;own_kickoff_recovery&quot;                
#&gt; [145] &quot;own_kickoff_recovery_td&quot;             
#&gt; [146] &quot;qb_hit&quot;                              
#&gt; [147] &quot;rush_attempt&quot;                        
#&gt; [148] &quot;pass_attempt&quot;                        
#&gt; [149] &quot;sack&quot;                                
#&gt; [150] &quot;touchdown&quot;                           
#&gt; [151] &quot;pass_touchdown&quot;                      
#&gt; [152] &quot;rush_touchdown&quot;                      
#&gt; [153] &quot;return_touchdown&quot;                    
#&gt; [154] &quot;extra_point_attempt&quot;                 
#&gt; [155] &quot;two_point_attempt&quot;                   
#&gt; [156] &quot;field_goal_attempt&quot;                  
#&gt; [157] &quot;kickoff_attempt&quot;                     
#&gt; [158] &quot;punt_attempt&quot;                        
#&gt; [159] &quot;fumble&quot;                              
#&gt; [160] &quot;complete_pass&quot;                       
#&gt; [161] &quot;assist_tackle&quot;                       
#&gt; [162] &quot;lateral_reception&quot;                   
#&gt; [163] &quot;lateral_rush&quot;                        
#&gt; [164] &quot;lateral_return&quot;                      
#&gt; [165] &quot;lateral_recovery&quot;                    
#&gt; [166] &quot;passer_player_id&quot;                    
#&gt; [167] &quot;passer_player_name&quot;                  
#&gt; [168] &quot;receiver_player_id&quot;                  
#&gt; [169] &quot;receiver_player_name&quot;                
#&gt; [170] &quot;rusher_player_id&quot;                    
#&gt; [171] &quot;rusher_player_name&quot;                  
#&gt; [172] &quot;lateral_receiver_player_id&quot;          
#&gt; [173] &quot;lateral_receiver_player_name&quot;        
#&gt; [174] &quot;lateral_rusher_player_id&quot;            
#&gt; [175] &quot;lateral_rusher_player_name&quot;          
#&gt; [176] &quot;lateral_sack_player_id&quot;              
#&gt; [177] &quot;lateral_sack_player_name&quot;            
#&gt; [178] &quot;interception_player_id&quot;              
#&gt; [179] &quot;interception_player_name&quot;            
#&gt; [180] &quot;lateral_interception_player_id&quot;      
#&gt; [181] &quot;lateral_interception_player_name&quot;    
#&gt; [182] &quot;punt_returner_player_id&quot;             
#&gt; [183] &quot;punt_returner_player_name&quot;           
#&gt; [184] &quot;lateral_punt_returner_player_id&quot;     
#&gt; [185] &quot;lateral_punt_returner_player_name&quot;   
#&gt; [186] &quot;kickoff_returner_player_name&quot;        
#&gt; [187] &quot;kickoff_returner_player_id&quot;          
#&gt; [188] &quot;lateral_kickoff_returner_player_id&quot;  
#&gt; [189] &quot;lateral_kickoff_returner_player_name&quot;
#&gt; [190] &quot;punter_player_id&quot;                    
#&gt; [191] &quot;punter_player_name&quot;                  
#&gt; [192] &quot;kicker_player_name&quot;                  
#&gt; [193] &quot;kicker_player_id&quot;                    
#&gt; [194] &quot;own_kickoff_recovery_player_id&quot;      
#&gt; [195] &quot;own_kickoff_recovery_player_name&quot;    
#&gt; [196] &quot;blocked_player_id&quot;                   
#&gt; [197] &quot;blocked_player_name&quot;                 
#&gt; [198] &quot;tackle_for_loss_1_player_id&quot;         
#&gt; [199] &quot;tackle_for_loss_1_player_name&quot;       
#&gt; [200] &quot;tackle_for_loss_2_player_id&quot;         
#&gt; [201] &quot;tackle_for_loss_2_player_name&quot;       
#&gt; [202] &quot;qb_hit_1_player_id&quot;                  
#&gt; [203] &quot;qb_hit_1_player_name&quot;                
#&gt; [204] &quot;qb_hit_2_player_id&quot;                  
#&gt; [205] &quot;qb_hit_2_player_name&quot;                
#&gt; [206] &quot;forced_fumble_player_1_team&quot;         
#&gt; [207] &quot;forced_fumble_player_1_player_id&quot;    
#&gt; [208] &quot;forced_fumble_player_1_player_name&quot;  
#&gt; [209] &quot;forced_fumble_player_2_team&quot;         
#&gt; [210] &quot;forced_fumble_player_2_player_id&quot;    
#&gt; [211] &quot;forced_fumble_player_2_player_name&quot;  
#&gt; [212] &quot;solo_tackle_1_team&quot;                  
#&gt; [213] &quot;solo_tackle_2_team&quot;                  
#&gt; [214] &quot;solo_tackle_1_player_id&quot;             
#&gt; [215] &quot;solo_tackle_2_player_id&quot;             
#&gt; [216] &quot;solo_tackle_1_player_name&quot;           
#&gt; [217] &quot;solo_tackle_2_player_name&quot;           
#&gt; [218] &quot;assist_tackle_1_player_id&quot;           
#&gt; [219] &quot;assist_tackle_1_player_name&quot;         
#&gt; [220] &quot;assist_tackle_1_team&quot;                
#&gt; [221] &quot;assist_tackle_2_player_id&quot;           
#&gt; [222] &quot;assist_tackle_2_player_name&quot;         
#&gt; [223] &quot;assist_tackle_2_team&quot;                
#&gt; [224] &quot;assist_tackle_3_player_id&quot;           
#&gt; [225] &quot;assist_tackle_3_player_name&quot;         
#&gt; [226] &quot;assist_tackle_3_team&quot;                
#&gt; [227] &quot;assist_tackle_4_player_id&quot;           
#&gt; [228] &quot;assist_tackle_4_player_name&quot;         
#&gt; [229] &quot;assist_tackle_4_team&quot;                
#&gt; [230] &quot;pass_defense_1_player_id&quot;            
#&gt; [231] &quot;pass_defense_1_player_name&quot;          
#&gt; [232] &quot;pass_defense_2_player_id&quot;            
#&gt; [233] &quot;pass_defense_2_player_name&quot;          
#&gt; [234] &quot;fumbled_1_team&quot;                      
#&gt; [235] &quot;fumbled_1_player_id&quot;                 
#&gt; [236] &quot;fumbled_1_player_name&quot;               
#&gt; [237] &quot;fumbled_2_player_id&quot;                 
#&gt; [238] &quot;fumbled_2_player_name&quot;               
#&gt; [239] &quot;fumbled_2_team&quot;                      
#&gt; [240] &quot;fumble_recovery_1_team&quot;              
#&gt; [241] &quot;fumble_recovery_1_yards&quot;             
#&gt; [242] &quot;fumble_recovery_1_player_id&quot;         
#&gt; [243] &quot;fumble_recovery_1_player_name&quot;       
#&gt; [244] &quot;fumble_recovery_2_team&quot;              
#&gt; [245] &quot;fumble_recovery_2_yards&quot;             
#&gt; [246] &quot;fumble_recovery_2_player_id&quot;         
#&gt; [247] &quot;fumble_recovery_2_player_name&quot;       
#&gt; [248] &quot;return_team&quot;                         
#&gt; [249] &quot;return_yards&quot;                        
#&gt; [250] &quot;penalty_team&quot;                        
#&gt; [251] &quot;penalty_player_id&quot;                   
#&gt; [252] &quot;penalty_player_name&quot;                 
#&gt; [253] &quot;penalty_yards&quot;                       
#&gt; [254] &quot;replay_or_challenge&quot;                 
#&gt; [255] &quot;replay_or_challenge_result&quot;          
#&gt; [256] &quot;penalty_type&quot;                        
#&gt; [257] &quot;defensive_two_point_attempt&quot;         
#&gt; [258] &quot;defensive_two_point_conv&quot;            
#&gt; [259] &quot;defensive_extra_point_attempt&quot;       
#&gt; [260] &quot;defensive_extra_point_conv&quot;          
#&gt; [261] &quot;season&quot;                              
#&gt; [262] &quot;cp&quot;                                  
#&gt; [263] &quot;cpoe&quot;                                
#&gt; [264] &quot;series&quot;                              
#&gt; [265] &quot;series_success&quot;                      
#&gt; [266] &quot;start_time&quot;                          
#&gt; [267] &quot;stadium&quot;                             
#&gt; [268] &quot;weather&quot;                             
#&gt; [269] &quot;nfl_api_id&quot;                          
#&gt; [270] &quot;play_clock&quot;                          
#&gt; [271] &quot;play_deleted&quot;                        
#&gt; [272] &quot;play_type_nfl&quot;                       
#&gt; [273] &quot;end_clock_time&quot;                      
#&gt; [274] &quot;end_yard_line&quot;                       
#&gt; [275] &quot;drive_real_start_time&quot;               
#&gt; [276] &quot;drive_play_count&quot;                    
#&gt; [277] &quot;drive_time_of_possession&quot;            
#&gt; [278] &quot;drive_first_downs&quot;                   
#&gt; [279] &quot;drive_inside20&quot;                      
#&gt; [280] &quot;drive_ended_with_score&quot;              
#&gt; [281] &quot;drive_quarter_start&quot;                 
#&gt; [282] &quot;drive_quarter_end&quot;                   
#&gt; [283] &quot;drive_yards_penalized&quot;               
#&gt; [284] &quot;drive_start_transition&quot;              
#&gt; [285] &quot;drive_end_transition&quot;                
#&gt; [286] &quot;drive_game_clock_start&quot;              
#&gt; [287] &quot;drive_game_clock_end&quot;                
#&gt; [288] &quot;drive_start_yard_line&quot;               
#&gt; [289] &quot;drive_end_yard_line&quot;                 
#&gt; [290] &quot;drive_play_id_started&quot;               
#&gt; [291] &quot;drive_play_id_ended&quot;                 
#&gt; [292] &quot;away_score&quot;                          
#&gt; [293] &quot;home_score&quot;                          
#&gt; [294] &quot;location&quot;                            
#&gt; [295] &quot;result&quot;                              
#&gt; [296] &quot;total&quot;                               
#&gt; [297] &quot;spread_line&quot;                         
#&gt; [298] &quot;total_line&quot;                          
#&gt; [299] &quot;div_game&quot;                            
#&gt; [300] &quot;roof&quot;                                
#&gt; [301] &quot;surface&quot;                             
#&gt; [302] &quot;temp&quot;                                
#&gt; [303] &quot;wind&quot;                                
#&gt; [304] &quot;home_coach&quot;                          
#&gt; [305] &quot;away_coach&quot;                          
#&gt; [306] &quot;stadium_id&quot;                          
#&gt; [307] &quot;game_stadium&quot;                        
#&gt; [308] &quot;success&quot;                             
#&gt; [309] &quot;passer&quot;                              
#&gt; [310] &quot;rusher&quot;                              
#&gt; [311] &quot;receiver&quot;                            
#&gt; [312] &quot;pass&quot;                                
#&gt; [313] &quot;rush&quot;                                
#&gt; [314] &quot;first_down&quot;                          
#&gt; [315] &quot;special&quot;                             
#&gt; [316] &quot;play&quot;                                
#&gt; [317] &quot;passer_id&quot;                           
#&gt; [318] &quot;rusher_id&quot;                           
#&gt; [319] &quot;receiver_id&quot;                         
#&gt; [320] &quot;name&quot;                                
#&gt; [321] &quot;id&quot;                                  
#&gt; [322] &quot;qb_epa&quot;</code></pre>
<p>That is a lot to work with!</p>
</div>
<div id="section-viewer" class="section level3">
<h3>Viewer</h3>
<p>One more way to look at your data is with the <code>View()</code> function. If you’re coming from an Excel background, this will help you feel more at home as a way to see what’s in the data.</p>
<pre class="r"><code>View(data)</code></pre>
<p>This will open the viewer in RStudio in a new panel. Try it out yourself! Since there are so many columns, the Viewer won’t show them all. To pick which columns to view, you can <strong>select</strong> some:</p>
<pre class="r"><code>data %&gt;%
  select(home_team, away_team, posteam, desc) %&gt;%
  View()</code></pre>
<p>The <code>%&gt;%</code> thing lets you pipe together a bunch of different commands. So we’re taking our data, “<code>select</code>”ing a few variables we want to look at, and then Viewing. Again, I can’t display the results of that here, but try it out yourself!</p>
</div>
<div id="section-head-manipulation" class="section level3">
<h3>Head + manipulation</h3>
<p>To start, let’s just look at the first few rows (the “head”) of the data.</p>
<pre class="r"><code>data %&gt;% 
  select(posteam, defteam, desc, rush, pass) %&gt;% 
  head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["posteam"],"name":[1],"type":["chr"],"align":["left"]},{"label":["defteam"],"name":[2],"type":["chr"],"align":["left"]},{"label":["desc"],"name":[3],"type":["chr"],"align":["left"]},{"label":["rush"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["pass"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NA","2":"NA","3":"GAME","4":"0","5":"0"},{"1":"ATL","2":"MIN","3":"5-D.Bailey kicks 65 yards from MIN 35 to end zone, Touchback.","4":"0","5":"0"},{"1":"ATL","2":"MIN","3":"(15:00) 2-M.Ryan sacked at ATL 17 for -8 yards (55-A.Barr).","4":"0","5":"1"},{"1":"ATL","2":"MIN","3":"(14:20) 24-D.Freeman right tackle to ATL 21 for 4 yards (93-S.Stephen).","4":"1","5":"0"},{"1":"ATL","2":"MIN","3":"(13:41) (Shotgun) 2-M.Ryan scrambles left end to ATL 33 for 12 yards (55-A.Barr).","4":"0","5":"1"},{"1":"ATL","2":"MIN","3":"(12:59) 5-M.Bosher punt is BLOCKED by 50-E.Wilson, Center-47-J.Harris, RECOVERED by MIN-50-E.Wilson at ATL 21. 50-E.Wilson to ATL 21 for no gain (41-S.Neasman).","4":"0","5":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>A couple things. “<code>desc</code>” is the important variable that lists the description of what happened on the play, and <code>head</code> says to show the first few rows (the “head” of the data). Since this is already sorted by game, these are the first 6 rows from a week 1 game, ATL @ MIN. To make code easier to read, people often put each part of a pipe on a new line, which is useful when working with more complicated functions. We could run:</p>
<pre class="r"><code>data %&gt;% select(posteam, defteam, desc, rush, pass) %&gt;% head()</code></pre>
<p>And it would return the exact same output as the one written out in multiple lines, but the code isn’t as easy to read.</p>
<p>We’ve covered <code>select</code>, and the next important function to learn is <code>filter</code>, which lets you filter the data to what you want. The following returns only plays that are run plays and pass plays; i.e., no punts, kickoffs, field goals, or dead ball penalties (e.g. false starts) where we don’t know what the attempted play was.</p>
<pre class="r"><code>data %&gt;% 
  filter(rush == 1 | pass == 1) %&gt;%
  select(posteam, desc, rush, pass, name, passer, rusher, receiver) %&gt;% 
  head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["posteam"],"name":[1],"type":["chr"],"align":["left"]},{"label":["desc"],"name":[2],"type":["chr"],"align":["left"]},{"label":["rush"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["pass"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["name"],"name":[5],"type":["chr"],"align":["left"]},{"label":["passer"],"name":[6],"type":["chr"],"align":["left"]},{"label":["rusher"],"name":[7],"type":["chr"],"align":["left"]},{"label":["receiver"],"name":[8],"type":["chr"],"align":["left"]}],"data":[{"1":"ATL","2":"(15:00) 2-M.Ryan sacked at ATL 17 for -8 yards (55-A.Barr).","3":"0","4":"1","5":"M.Ryan","6":"M.Ryan","7":"NA","8":"NA"},{"1":"ATL","2":"(14:20) 24-D.Freeman right tackle to ATL 21 for 4 yards (93-S.Stephen).","3":"1","4":"0","5":"D.Freeman","6":"NA","7":"D.Freeman","8":"NA"},{"1":"ATL","2":"(13:41) (Shotgun) 2-M.Ryan scrambles left end to ATL 33 for 12 yards (55-A.Barr).","3":"0","4":"1","5":"M.Ryan","6":"M.Ryan","7":"NA","8":"NA"},{"1":"MIN","2":"(12:53) 33-D.Cook right end pushed ob at ATL 8 for 13 yards (37-R.Allen). PENALTY on MIN-82-K.Rudolph, Offensive Holding, 10 yards, enforced at ATL 21 - No Play.","3":"1","4":"0","5":"D.Cook","6":"NA","7":"D.Cook","8":"NA"},{"1":"MIN","2":"(12:32) 8-K.Cousins pass short left to 33-D.Cook pushed ob at ATL 23 for 8 yards (44-V.Beasley).","3":"0","4":"1","5":"K.Cousins","6":"K.Cousins","7":"NA","8":"D.Cook"},{"1":"MIN","2":"(11:57) 8-K.Cousins pass short left to 19-A.Thielen for 23 yards, TOUCHDOWN [97-G.Jarrett].","3":"0","4":"1","5":"K.Cousins","6":"K.Cousins","7":"NA","8":"A.Thielen"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Compared to the first time we did this, the opening line for the start of the game, the kickoff, and the punt are now gone. Note that if you’re checking whether a variable is equal to something, we need to use the double equals sign <code>==</code> like above. There’s probably some technical reason for this [shrug emoji]. Also, the character <code>|</code> is used for “or”, and <code>&amp;</code> for “and”. So <code>rush == 1 | pass == 1</code> means “rush or pass”.</p>
<p>Note that the <code>rush</code>, <code>pass</code>, <code>name</code>, <code>passer</code>, <code>rusher</code>, and <code>receiver</code> columns are all <code>nflfastR</code> creations, where we have provided these to make working with the data easier. As we can see above, <code>passer</code> is filled in for all dropbacks (including sacks and scrambles, which also have <code>pass</code> = 1), and <code>name</code> is equal to the passer on pass plays and the rusher on rush plays. Think of this as the primary player involved on a play.</p>
<p>What if we wanted to view special teams plays? Again, we can use <code>filter</code>:</p>
<pre class="r"><code>data %&gt;% 
  filter(special == 1) %&gt;%
  select(down, ydstogo, desc) %&gt;% 
  head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["down"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["ydstogo"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["desc"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"NA","2":"0","3":"5-D.Bailey kicks 65 yards from MIN 35 to end zone, Touchback."},{"1":"4","2":"2","3":"(12:59) 5-M.Bosher punt is BLOCKED by 50-E.Wilson, Center-47-J.Harris, RECOVERED by MIN-50-E.Wilson at ATL 21. 50-E.Wilson to ATL 21 for no gain (41-S.Neasman)."},{"1":"NA","2":"0","3":"(Kick formation) 5-D.Bailey extra point is GOOD, Center-58-A.Cutting, Holder-2-B.Colquitt."},{"1":"NA","2":"0","3":"5-D.Bailey kicks 67 yards from MIN 35 to ATL -2. 38-K.Barner to ATL 16 for 18 yards (40-K.Brothers)."},{"1":"NA","2":"0","3":"(Kick formation) 5-D.Bailey extra point is GOOD, Center-58-A.Cutting, Holder-2-B.Colquitt."},{"1":"NA","2":"0","3":"5-D.Bailey kicks 65 yards from MIN 35 to end zone, Touchback."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Fourth down plays?</p>
<pre class="r"><code>data %&gt;% 
  filter(down == 4) %&gt;%
  select(down, ydstogo, desc) %&gt;% 
  head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["down"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["ydstogo"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["desc"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"4","2":"2","3":"(12:59) 5-M.Bosher punt is BLOCKED by 50-E.Wilson, Center-47-J.Harris, RECOVERED by MIN-50-E.Wilson at ATL 21. 50-E.Wilson to ATL 21 for no gain (41-S.Neasman)."},{"1":"4","2":"19","3":"(2:38) 5-M.Bosher punts 33 yards to MIN 8, Center-47-J.Harris, fair catch by 12-C.Beebe."},{"1":"4","2":"20","3":"(12:33) 2-B.Colquitt punts 51 yards to ATL 17, Center-58-A.Cutting. 38-K.Barner to ATL 28 for 11 yards (27-J.Kearse; 50-E.Wilson)."},{"1":"4","2":"27","3":"(1:49) 5-M.Bosher punts 45 yards to MIN 10, Center-47-J.Harris, fair catch by 12-C.Beebe."},{"1":"4","2":"10","3":"(:49) 2-B.Colquitt punts 57 yards to ATL 33, Center-58-A.Cutting. 38-K.Barner to ATL 45 for 12 yards (40-K.Brothers)."},{"1":"4","2":"1","3":"(10:56) 2-B.Colquitt punts 42 yards to ATL 10, Center-58-A.Cutting. 38-K.Barner to ATL 15 for 5 yards (38-K.Boyd)."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Fourth down plays that aren’t special teams plays?</p>
<pre class="r"><code>data %&gt;% 
  filter(down == 4 &amp; special == 0) %&gt;%
  select(down, ydstogo, desc) %&gt;% 
  head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["down"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["ydstogo"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["desc"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"4","2":"5","3":"(9:25) (Shotgun) 2-M.Ryan pass deep left to 18-C.Ridley for 20 yards, TOUCHDOWN."},{"1":"4","2":"2","3":"(4:39) (Punt formation) PENALTY on MIN, Delay of Game, 5 yards, enforced at MIN 49 - No Play."},{"1":"4","2":"2","3":"(1:27) (No Huddle, Shotgun) 2-M.Ryan pass short left to 11-J.Jones to MIN 18 for 5 yards (27-J.Kearse)."},{"1":"4","2":"1","3":"(2:59) (Punt formation) Direct snap to 41-A.Levine.  41-A.Levine up the middle to MIA 10 for 60 yards (19-J.Grant)."},{"1":"4","2":"3","3":"(9:30) (Shotgun) 3-R.Griffin pass short left to 89-M.Andrews for 3 yards, TOUCHDOWN."},{"1":"4","2":"1","3":"(3:55) 17-J.Allen FUMBLES (Aborted) at NYJ 37, RECOVERED by NYJ-57-C.Mosley at NYJ 37. 57-C.Mosley to NYJ 37 for no gain (85-L.Smith)."}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>So far, we’ve just been taking a look at the initial dataset we downloaded, but none of our results are preserved. To save a new dataframe of just the plays we want, we need to use <code>&lt;-</code> to assign a new dataframe. Let’s save a new dataframe that’s just run plays and pass plays with non-missing EPA, called <code>pbp_rp</code>.</p>
<pre class="r"><code>pbp_rp &lt;- data %&gt;%
  filter(rush == 1 | pass == 1, !is.na(epa))</code></pre>
<p>In the above, <code>!is.na(epa)</code> means to exclude plays with missing (<code>na</code>) EPA. The <code>!</code> symbol is often used by computer folk to negate something, so <code>is.na(epa)</code> means “EPA is missing” and <code>!is.na(epa)</code> means “EPA is not missing”, which we have used above.</p>
</div>
</div>
<div id="section-some-basic-stuff-part-1" class="section level2">
<h2>Some basic stuff: Part 1</h2>
<p>Okay, we have a big dataset where we call dropbacks pass plays and non-dropbacks rush plays. Now we actually want to, like, do stuff.</p>
<div id="section-group-by-and-summarize" class="section level3">
<h3>Group by and Summarize</h3>
<p>Let’s take a look at how various Cowboys’ running backs fared on run plays in 2019:</p>
<pre class="r"><code>pbp_rp %&gt;%
    filter(posteam == &quot;DAL&quot;, rush == 1) %&gt;%
    group_by(rusher) %&gt;%
    summarize(
      mean_epa = mean(epa), success_rate = mean(success), ypc=mean(yards_gained), plays=n()
      ) %&gt;%
    arrange(-mean_epa) %&gt;%
    filter(plays &gt; 20)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["rusher"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean_epa"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["success_rate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ypc"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["plays"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"D.Prescott","2":"0.28084030","3":"0.5909091","4":"6.409091","5":"22"},{"1":"T.Pollard","2":"-0.02142875","3":"0.4444444","4":"5.077778","5":"90"},{"1":"E.Elliott","2":"-0.03518750","3":"0.4174757","4":"4.391586","5":"309"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>There’s a lot going on here. We’ve covered <code>filter</code> already. The <code>group_by</code> function is an <em>extremely</em> useful function that, well, groups by what you tell it – in this case the rusher. Summarize is useful for collapsing the data down to a summary of what you’re looking at, and here, while grouping by player, we’re summarizing the mean of EPA, success, yardage (a bad rushing stat, but since we’re here), and getting the number of plays using <code>n()</code>, which returns the number in a group. Unsurprisingly, Prescott was much more effective as a rusher in 2019 than the running backs, and there was no meaningful difference between Pollard and Elliott in efficiency.</p>
<p>If you check the <a href="https://www.pro-football-reference.com/teams/dal/2019.htm">PFR team stats page</a>, you’ll notice that the above doesn’t match up with the official stats. This is because <code>nflfastR</code> computes EPA and provides player names on plays with penalties and on two-point conversions. So if wanting to match the official stats, we need to restrict to <code>down &lt;= 4</code> (to excluded two-point conversions, which have down listed as <code>NA</code>) and <code>play_type = run</code> (to exclude penalties, which are <code>play_type = no_play</code>):</p>
<pre class="r"><code>pbp_rp %&gt;%
    filter(posteam == &quot;DAL&quot;, down &lt;=4, play_type == &#39;run&#39;) %&gt;%
    group_by(rusher) %&gt;%
    summarize(
      mean_epa = mean(epa), success_rate = mean(success), ypc=mean(yards_gained), plays=n()
      ) %&gt;%
    filter(plays &gt; 20)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["rusher"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean_epa"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["success_rate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ypc"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["plays"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"D.Prescott","2":"0.28084030","3":"0.5909091","4":"6.409091","5":"22"},{"1":"E.Elliott","2":"-0.01185024","3":"0.4285714","4":"4.508306","5":"301"},{"1":"T.Pollard","2":"-0.01355589","3":"0.4418605","4":"5.290698","5":"86"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now we exactly match PFR: Zeke has 301 carries at 4.5 yards/carry, and Pollard has 86 carries for 5.3 yards/carry. Note that we still aren’t matching Dak’s stats to PFR because the NFL classifies scrambles as rush attempts and <code>nflfastR</code> does not.</p>
</div>
<div id="section-manipulating-columns-mutate-if_else-and-case_when" class="section level3">
<h3>Manipulating columns: mutate, if_else, and case_when</h3>
<p>Let’s say we want to make a new column, named <code>home</code>, which is equal to 1 if the team with the ball is the home team. Let’s introduce another extremely useful function, <code>if_else</code>:</p>
<pre class="r"><code>pbp_rp %&gt;%
  mutate(
    home = if_else(posteam == home_team, 1, 0)
  ) %&gt;%
  select(posteam, home_team, home) %&gt;%
  head(10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["posteam"],"name":[1],"type":["chr"],"align":["left"]},{"label":["home_team"],"name":[2],"type":["chr"],"align":["left"]},{"label":["home"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"ATL","2":"MIN","3":"0"},{"1":"ATL","2":"MIN","3":"0"},{"1":"ATL","2":"MIN","3":"0"},{"1":"MIN","2":"MIN","3":"1"},{"1":"MIN","2":"MIN","3":"1"},{"1":"MIN","2":"MIN","3":"1"},{"1":"ATL","2":"MIN","3":"0"},{"1":"ATL","2":"MIN","3":"0"},{"1":"ATL","2":"MIN","3":"0"},{"1":"MIN","2":"MIN","3":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><code>mutate</code> is R’s word for creating a new column (or overwriting an existing one); in this case, we’ve created a new column called <code>home</code>. The above uses <code>if_else</code>, which uses the following pattern: condition (in this case, <code>posteam == home_team</code>), value if condition is true (in this case, if <code>posteam == home_team</code>, it is 1), and value if the condition is false (0). So we could use this to, for example, look at average EPA/play by home and road teams:</p>
<pre class="r"><code>pbp_rp %&gt;%
  mutate(
    home = if_else(posteam == home_team, 1, 0)
  ) %&gt;%
  group_by(home) %&gt;%
  summarize(epa = mean(epa))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["home"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["epa"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"0","2":"0.03179212"},{"1":"1","2":"-0.01169028"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Note that EPA/play is similar for home teams and away teams because <code>home</code> is already built into the <code>nflfastR</code> EPA model, so this result is expected. Actually, away EPA/play is actually somewhat higher, presumably because away teams out-performed their usual in 2019 as homefield advantage continues to decline generally.</p>
<p><code>if_else</code> is nice if you’re creating a new column based on a simple condition. But what if you need to do something more complicated? <code>case_when</code> is a good option. Here’s how it works:</p>
<pre class="r"><code>pbp_rp %&gt;%
  filter(!is.na(cp)) %&gt;%
  mutate(
    depth = case_when(
      air_yards &lt; 0 ~ &quot;Negative&quot;,
      air_yards &gt;= 0 &amp; air_yards &lt; 10 ~ &quot;Short&quot;,
      air_yards &gt;= 10 &amp; air_yards &lt; 20 ~ &quot;Medium&quot;,
      air_yards &gt;= 20 ~ &quot;Deep&quot;
    )
  ) %&gt;%
  group_by(depth) %&gt;%
  summarize(cp = mean(cp))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["depth"],"name":[1],"type":["chr"],"align":["left"]},{"label":["cp"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"Deep","2":"0.3667375"},{"1":"Medium","2":"0.5713994"},{"1":"Negative","2":"0.8476375"},{"1":"Short","2":"0.7173421"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Note the new syntax for <code>case_when</code>: we have condition (for the first one, air yards less than 0), followed by <code>~</code>, followed by assignment (for the first one, “Negative”). In the above, we created 4 bins based on air yards and got average completion probability (<code>cp</code>) based on the <code>nflfastR</code> model. Unsurprisingly, <code>cp</code> is lower the longer downfield a throw goes.</p>
</div>
<div id="section-a-basic-figure" class="section level3">
<h3>A basic figure</h3>
<p>Now that we’ve gained some skills at manipulating data, let’s put it to use by making things. Which teams were the most pass-heavy in the first half on early downs with win probability between 20 and 80, excluding the final 2 minutes of the half when everyone is pass-happy?</p>
<pre class="r"><code>schotty &lt;- pbp_rp %&gt;%
    filter(wp &gt; .20 &amp; wp &lt; .80 &amp; down &lt;= 2 &amp; qtr &lt;= 2 &amp; half_seconds_remaining &gt; 120) %&gt;%
    group_by(posteam) %&gt;%
    summarize(mean_pass = mean(pass), plays = n()) %&gt;%
    arrange(-mean_pass)
schotty</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["posteam"],"name":[1],"type":["chr"],"align":["left"]},{"label":["mean_pass"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["plays"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"KC","2":"0.6861702","3":"376"},{"1":"MIA","2":"0.5972222","3":"288"},{"1":"LA","2":"0.5866261","3":"329"},{"1":"NO","2":"0.5838509","3":"322"},{"1":"CHI","2":"0.5686275","3":"306"},{"1":"GB","2":"0.5563380","3":"284"},{"1":"CLE","2":"0.5539568","3":"278"},{"1":"TB","2":"0.5520505","3":"317"},{"1":"CAR","2":"0.5477941","3":"272"},{"1":"ARI","2":"0.5471698","3":"318"},{"1":"PHI","2":"0.5444126","3":"349"},{"1":"ATL","2":"0.5394322","3":"317"},{"1":"BUF","2":"0.5366569","3":"341"},{"1":"NE","2":"0.5294118","3":"323"},{"1":"LAC","2":"0.5249169","3":"301"},{"1":"HOU","2":"0.5172414","3":"348"},{"1":"NYG","2":"0.5168539","3":"267"},{"1":"NYJ","2":"0.5131086","3":"267"},{"1":"JAX","2":"0.5115385","3":"260"},{"1":"SF","2":"0.5032051","3":"312"},{"1":"DAL","2":"0.5031056","3":"322"},{"1":"DEN","2":"0.4962963","3":"270"},{"1":"SEA","2":"0.4954683","3":"331"},{"1":"PIT","2":"0.4925926","3":"270"},{"1":"CIN","2":"0.4901961","3":"255"},{"1":"LV","2":"0.4835526","3":"304"},{"1":"DET","2":"0.4832215","3":"298"},{"1":"TEN","2":"0.4787879","3":"330"},{"1":"MIN","2":"0.4652778","3":"288"},{"1":"WAS","2":"0.4641509","3":"265"},{"1":"IND","2":"0.4343434","3":"297"},{"1":"BAL","2":"0.4327869","3":"305"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Again, we’ve already used <code>filter</code>, <code>group_by</code>, and <code>summarize</code>. The new function we are using here is <code>arrange</code>, which sorts the data by the variable(s) given. The minus sign in front of <code>mean_pass</code> means to sort in descending order.</p>
<p>Let’s make our first figure:</p>
<pre class="r"><code>ggplot(schotty, aes(x=reorder(posteam,-mean_pass), y=mean_pass)) +
        geom_text(aes(label=posteam))</code></pre>
<p><img src="beginner_guide_files/figure-html/fig1-1.png" width="100%" /></p>
<p>This image is kind of a mess – we still need a title, axis labels, etc – but gets the point across. We’ll get to that other stuff later. But more importantly, we made something interesting using <code>nflfastR</code> data! The “reorder” sorts the teams according to pass rate, with the “-” again saying to do it in descending order. “aes” is short for “aesthetic”, which is R’s weird way of asking which variables should go on the x and y axes.</p>
<p>Looking at the figure, the Chiefs will never have playoff success until they establish the run.</p>
</div>
</div>
<div id="section-loading-multiple-seasons" class="section level2">
<h2>Loading multiple seasons</h2>
<p>Because all the data is stored in the data repository, it is very easy to use data from multiple seasons. <a href="https://github.com/guga31bb/nflfastR-data">The repository page</a> has instructions for loading multiple seasons:</p>
<pre class="r"><code>seasons &lt;- 2015:2019
pbp &lt;- map_df(seasons, function(x) {
  readRDS(
    url(
      paste0(&quot;https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_&quot;,x,&quot;.rds&quot;)
    )
  )
})</code></pre>
<p>You don’t need to understand this one yet, but if you’re curious, <code>map_df</code> stitches together the output from running a function repeatedly with different inputs. In this case, the function is simply reading one season’s data, and the inputs are the list of seasons we want: in the above, 2015 through 2019. But all you need to know how to do is change the range of seasons to get whichever seasons you want.</p>
<p>Let’s make sure we got it all. By now, you should understand what this is doing:</p>
<pre class="r"><code>pbp %&gt;%
  group_by(season) %&gt;%
  summarize(n = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["season"],"name":[1],"type":["int"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2015","2":"48869"},{"1":"2016","2":"48419"},{"1":"2017","2":"47997"},{"1":"2018","2":"47874"},{"1":"2019","2":"48034"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>So each season has about 48,000 plays. Just for fun, let’s look at the various play types:</p>
<pre class="r"><code>pbp %&gt;%
  group_by(play_type) %&gt;%
  summarize(n = n())</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["play_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"extra_point","2":"6115"},{"1":"field_goal","2":"5138"},{"1":"kickoff","2":"13459"},{"1":"no_play","2":"23187"},{"1":"pass","2":"99579"},{"1":"punt","2":"12021"},{"1":"qb_kneel","2":"2156"},{"1":"qb_spike","2":"338"},{"1":"run","2":"68129"},{"1":"NA","2":"11071"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="section-figures-with-qb-stats" class="section level2">
<h2>Figures with QB stats</h2>
<p>Let’s do some stuff with quarterbacks:</p>
<pre class="r"><code>qbs &lt;- pbp %&gt;%
  filter(week &lt;= 17, !is.na(epa)) %&gt;%
  group_by(id, name) %&gt;%
  summarize(
    epa = mean(qb_epa),
    cpoe = mean(cpoe, na.rm = T),
    n_dropbacks = sum(pass),
    n_plays = n(),
    team = last(posteam)
  ) %&gt;%
  ungroup() %&gt;%
  filter(n_dropbacks &gt; 100 &amp; n_plays &gt; 1000)</code></pre>
<p>Lots of new stuff here. First, we’re grouping by <code>id</code> and <code>name</code> to make sure we’re getting unique players; i.e., if two players have the same name (like Javorius Allen and Josh Allen both being J.Allen), we are also using their id to differntiate them. <strong>Note that this use of id only works if you are not mixing data from before and after 2011: the IDs are different prior to 2011</strong>. <code>qb_epa</code> is an <code>nflfastR</code> creation that is equal to EPA in all instances except for when a pass is completed and a fumble is lost, in which case a QB gets “credit” for the play up to the spot the fumble was lost (making EPA function like passing yards). The <code>last</code> part in the <code>summarize</code> comment gets the last team that a player was observed playing with.</p>
<p>Because there’s no way to join to rosters (yet?), my way of getting a dataset with only quarterbacks is to make sure they hit some number of dropbacks. In this case, filtering with <code>n_dropbacks &gt; 100</code> makes sure we’re only including quarterbacks. The <code>ungroup()</code> near the end is good practice after grouping to make sure you don’t get weird behavior with the data you created down the line.</p>
<p>Let’s make some more figures. The <code>team_colors_logos</code> dataframe is provided in the <code>nflfastR</code> package, so since we have already loaded the package, it’s ready to use.</p>
<pre class="r"><code>head(teams_colors_logos)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["team_abbr"],"name":[1],"type":["chr"],"align":["left"]},{"label":["team_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["team_id"],"name":[3],"type":["chr"],"align":["left"]},{"label":["team_nick"],"name":[4],"type":["chr"],"align":["left"]},{"label":["team_color"],"name":[5],"type":["chr"],"align":["left"]},{"label":["team_color2"],"name":[6],"type":["chr"],"align":["left"]},{"label":["team_color3"],"name":[7],"type":["chr"],"align":["left"]},{"label":["team_color4"],"name":[8],"type":["chr"],"align":["left"]},{"label":["team_logo_wikipedia"],"name":[9],"type":["chr"],"align":["left"]},{"label":["team_logo_espn"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"ARI","2":"Arizona Cardinals","3":"3800","4":"Cardinals","5":"#97233f","6":"#000000","7":"#ffb612","8":"#a5acaf","9":"https://upload.wikimedia.org/wikipedia/en/thumb/7/72/Arizona_Cardinals_logo.svg/179px-Arizona_Cardinals_logo.svg.png","10":"https://a.espncdn.com/i/teamlogos/nfl/500/ari.png"},{"1":"ATL","2":"Atlanta Falcons","3":"0200","4":"Falcons","5":"#a71930","6":"#000000","7":"#a5acaf","8":"#a30d2d","9":"https://upload.wikimedia.org/wikipedia/en/thumb/c/c5/Atlanta_Falcons_logo.svg/192px-Atlanta_Falcons_logo.svg.png","10":"https://a.espncdn.com/i/teamlogos/nfl/500/atl.png"},{"1":"BAL","2":"Baltimore Ravens","3":"0325","4":"Ravens","5":"#241773","6":"#000000","7":"#9e7c0c","8":"#c60c30","9":"https://upload.wikimedia.org/wikipedia/en/thumb/1/16/Baltimore_Ravens_logo.svg/193px-Baltimore_Ravens_logo.svg.png","10":"https://a.espncdn.com/i/teamlogos/nfl/500/bal.png"},{"1":"BUF","2":"Buffalo Bills","3":"0610","4":"Bills","5":"#00338d","6":"#c60c30","7":"#0c2e82","8":"#d50a0a","9":"https://upload.wikimedia.org/wikipedia/en/thumb/7/77/Buffalo_Bills_logo.svg/189px-Buffalo_Bills_logo.svg.png","10":"https://a.espncdn.com/i/teamlogos/nfl/500/buf.png"},{"1":"CAR","2":"Carolina Panthers","3":"0750","4":"Panthers","5":"#0085ca","6":"#000000","7":"#bfc0bf","8":"#0085ca","9":"https://upload.wikimedia.org/wikipedia/en/thumb/1/1c/Carolina_Panthers_logo.svg/100px-Carolina_Panthers_logo.svg.png","10":"https://a.espncdn.com/i/teamlogos/nfl/500-dark/car.png"},{"1":"CHI","2":"Chicago Bears","3":"0810","4":"Bears","5":"#0b162a","6":"#c83803","7":"#0b162a","8":"#c83803","9":"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Chicago_Bears_logo.svg/100px-Chicago_Bears_logo.svg.png","10":"https://a.espncdn.com/i/teamlogos/nfl/500/chi.png"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Let’s join this to the <code>qbs</code> dataframe we created:</p>
<pre class="r"><code>qbs &lt;- qbs %&gt;%
  left_join(teams_colors_logos, by = c(&#39;team&#39; = &#39;team_abbr&#39;))</code></pre>
<p><code>left_join</code> means keep all the rows from the left dataframe (the first one provided, <code>qbs</code>), and join those rows to available rows in the other dataframe. We also need to provide the joining variables, <code>team</code> from <code>qbs</code> and <code>team_abbr</code> from <code>team_colors_logos</code>. Why do we have to type <code>by = c('team' = 'team_abbr')</code>? Who knows, but it’s what <code>left_join</code> requires as instructions for how to match.</p>
<div id="section-with-team-color-dots" class="section level3">
<h3>With team color dots</h3>
<p>Now we can make a figure!</p>
<pre class="r"><code>qbs %&gt;%
  ggplot(aes(x = cpoe, y = epa)) +
  #horizontal line with mean EPA
  geom_hline(yintercept = mean(qbs$epa), color = &quot;red&quot;, linetype = &quot;dashed&quot;, alpha=0.5) +
  #vertical line with mean CPOE
  geom_vline(xintercept =  mean(qbs$cpoe), color = &quot;red&quot;, linetype = &quot;dashed&quot;, alpha=0.5) +
  #add points for the QBs with the right colors
  #cex controls point size and alpha the transparency (alpha = 1 is normal)
  geom_point(color = qbs$team_color, cex=qbs$n_plays / 350, alpha = .6) +
  #add names using ggrepel, which tries to make them not overlap
  geom_text_repel(aes(label=name)) +
  #add a smooth line fitting cpoe + epa
  stat_smooth(geom=&#39;line&#39;, alpha=0.5, se=FALSE, method=&#39;lm&#39;)+
  #titles and caption
  labs(x = &quot;Completion % above expected (CPOE)&quot;,
       y = &quot;EPA per play (passes, rushes, and penalties)&quot;,
       title = &quot;Quarterback Efficiency, 2015 - 2019&quot;,
       caption = &quot;Data: @nflfastR&quot;) +
  #uses the black and white ggplot theme
  theme_bw() +
  #center title with hjust = 0.5
  theme(
    plot.title = element_text(size = 14, hjust = 0.5, face = &quot;bold&quot;)
  ) +
  #make ticks look nice
  #if this doesn&#39;t work, `install.packages(&#39;scales&#39;)`
  scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10))</code></pre>
<p><img src="beginner_guide_files/figure-html/fig2-1.png" width="100%" /></p>
<p>This looks complicated, but is just a way of getting a bunch of different stuff on the same plot: we have lines for averages, dots, names, etc. I added comments above to explain what is going on, but in practice for making figures I usually just copy and paste stuff and/or google what I need.</p>
</div>
<div id="section-with-team-logos" class="section level3">
<h3>With team logos</h3>
<p>We could also make the same plot with team logos:</p>
<pre class="r"><code>qbs %&gt;%
  ggplot(aes(x = cpoe, y = epa)) +
  #horizontal line with mean EPA
  geom_hline(yintercept = mean(qbs$epa), color = &quot;red&quot;, linetype = &quot;dashed&quot;, alpha=0.5) +
  #vertical line with mean CPOE
  geom_vline(xintercept =  mean(qbs$cpoe), color = &quot;red&quot;, linetype = &quot;dashed&quot;, alpha=0.5) +
  #add points for the QBs with the logos
  geom_image(aes(image = team_logo_espn), size = qbs$n_plays / 45000, asp = 16 / 9) +
  #add names using ggrepel, which tries to make them not overlap
  geom_text_repel(aes(label=name)) +
  #add a smooth line fitting cpoe + epa
  stat_smooth(geom=&#39;line&#39;, alpha=0.5, se=FALSE, method=&#39;lm&#39;)+
  #titles and caption
  labs(x = &quot;Completion % above expected (CPOE)&quot;,
       y = &quot;EPA per play (passes, rushes, and penalties)&quot;,
       title = &quot;Quarterback Efficiency, 2015 - 2019&quot;,
       caption = &quot;Data: @nflfastR&quot;) +
  theme_bw() +
  #center title
  theme(
    aspect.ratio = 9 / 16,
    plot.title = element_text(size = 14, hjust = 0.5, face = &quot;bold&quot;)
  ) +
  #make ticks look nice
  scale_y_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10))</code></pre>
<p><img src="beginner_guide_files/figure-html/fig3-1.png" width="100%" /></p>
<p>The only changes we’ve made are to use <code>geom_image</code> instead of <code>geom_point</code>, and to put <code>aspect.ratio = 9 / 16</code> in the <code>theme()</code> part. This makes the plot output dimensions consistent with the provided images and leads to the images not looking squished (how to figure out the right size for the images? Trial and error).</p>
<p>This figure would look better with transparent logos or fewer players shown, but the point of this is explaining how to do stuff, so let’s call this good enough.</p>
</div>
</div>
<div id="section-real-life-example-lets-make-a-win-total-model" class="section level2">
<h2>Real life example: let’s make a win total model</h2>
<p>I’m going to try to go through the process of cleaning and joining multiple data sets to try to get a sense of how I would approach something like this, step-by-step.</p>
<div id="section-get-team-wins-each-season" class="section level3">
<h3>Get team wins each season</h3>
<p>We’re going to cheat a little and take advantage of Lee Sharpe’s famous <code>games</code> file. Most of this stuff has been added into <code>nflfastR</code>, but it’s easier working with this file where each game is one row.</p>
<pre class="r"><code>games &lt;- readRDS(url(&quot;http://www.habitatring.com/games.rds&quot;))
str(games)
#&gt; tibble [5,839 x 31] (S3: tbl_df/tbl/data.frame)
#&gt;  $ game_id    : chr [1:5839] &quot;1999_01_MIN_ATL&quot; &quot;1999_01_KC_CHI&quot; &quot;1999_01_PIT_CLE&quot; &quot;1999_01_OAK_GB&quot; ...
#&gt;  $ season     : int [1:5839] 1999 1999 1999 1999 1999 1999 1999 1999 1999 1999 ...
#&gt;  $ game_type  : chr [1:5839] &quot;REG&quot; &quot;REG&quot; &quot;REG&quot; &quot;REG&quot; ...
#&gt;  $ week       : int [1:5839] 1 1 1 1 1 1 1 1 1 1 ...
#&gt;  $ gameday    : chr [1:5839] &quot;1999-09-12&quot; &quot;1999-09-12&quot; &quot;1999-09-12&quot; &quot;1999-09-12&quot; ...
#&gt;  $ weekday    : chr [1:5839] &quot;Sunday&quot; &quot;Sunday&quot; &quot;Sunday&quot; &quot;Sunday&quot; ...
#&gt;  $ gametime   : chr [1:5839] NA NA NA NA ...
#&gt;  $ away_team  : chr [1:5839] &quot;MIN&quot; &quot;KC&quot; &quot;PIT&quot; &quot;OAK&quot; ...
#&gt;  $ away_score : int [1:5839] 17 17 43 24 14 3 10 30 25 28 ...
#&gt;  $ home_team  : chr [1:5839] &quot;ATL&quot; &quot;CHI&quot; &quot;CLE&quot; &quot;GB&quot; ...
#&gt;  $ home_score : int [1:5839] 14 20 0 28 31 41 19 28 24 20 ...
#&gt;  $ location   : chr [1:5839] &quot;Home&quot; &quot;Home&quot; &quot;Home&quot; &quot;Home&quot; ...
#&gt;  $ result     : int [1:5839] -3 3 -43 4 17 38 9 -2 -1 -8 ...
#&gt;  $ total      : int [1:5839] 31 37 43 52 45 44 29 58 49 48 ...
#&gt;  $ old_game_id: chr [1:5839] &quot;1999091210&quot; &quot;1999091206&quot; &quot;1999091213&quot; &quot;1999091208&quot; ...
#&gt;  $ gsis       : int [1:5839] 598 597 604 602 591 603 592 600 588 596 ...
#&gt;  $ pfr        : chr [1:5839] &quot;199909120atl&quot; &quot;199909120chi&quot; &quot;199909120cle&quot; &quot;199909120gnb&quot; ...
#&gt;  $ pff        : int [1:5839] NA NA NA NA NA NA NA NA NA NA ...
#&gt;  $ espn       : chr [1:5839] &quot;190912001&quot; &quot;190912003&quot; &quot;190912005&quot; &quot;190912009&quot; ...
#&gt;  $ spread_line: num [1:5839] -4 -3 -6 9 -3 5.5 3.5 7 -3 9.5 ...
#&gt;  $ total_line : num [1:5839] 49 38 37 43 45.5 49 38 44.5 37 42 ...
#&gt;  $ div_game   : int [1:5839] 0 0 1 0 1 0 1 1 1 0 ...
#&gt;  $ roof       : chr [1:5839] &quot;dome&quot; &quot;outdoors&quot; &quot;outdoors&quot; &quot;outdoors&quot; ...
#&gt;  $ surface    : chr [1:5839] &quot;astroturf&quot; &quot;grass&quot; &quot;grass&quot; &quot;grass&quot; ...
#&gt;  $ temp       : int [1:5839] NA 80 78 67 NA 76 NA 73 75 NA ...
#&gt;  $ wind       : int [1:5839] NA 12 12 10 NA 8 NA 5 3 NA ...
#&gt;  $ away_coach : chr [1:5839] &quot;Dennis Green&quot; &quot;Gunther Cunningham&quot; &quot;Bill Cowher&quot; &quot;Jon Gruden&quot; ...
#&gt;  $ home_coach : chr [1:5839] &quot;Dan Reeves&quot; &quot;Dick Jauron&quot; &quot;Chris Palmer&quot; &quot;Ray Rhodes&quot; ...
#&gt;  $ referee    : chr [1:5839] &quot;Gerry Austin&quot; &quot;Phil Luckett&quot; &quot;Bob McElwee&quot; &quot;Tony Corrente&quot; ...
#&gt;  $ stadium_id : chr [1:5839] &quot;ATL00&quot; &quot;CHI98&quot; &quot;CLE00&quot; &quot;GNB00&quot; ...
#&gt;  $ stadium    : chr [1:5839] &quot;Georgia Dome&quot; &quot;Soldier Field&quot; &quot;Cleveland Browns Stadium&quot; &quot;Lambeau Field&quot; ...</code></pre>
<p>To start, we want to create a dataframe where each row is a team-season observation, listing how many games they won. There are multiple ways to do this, but I’m going to just take the home and away results and bind together. As an example, here’s what the <code>home</code> results look like:</p>
<pre class="r"><code>home &lt;- games %&gt;%
  filter(game_type == &#39;REG&#39;) %&gt;%
  select(season, week, home_team, result) %&gt;%
  rename(team = home_team)
home %&gt;% head(5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["season"],"name":[1],"type":["int"],"align":["right"]},{"label":["week"],"name":[2],"type":["int"],"align":["right"]},{"label":["team"],"name":[3],"type":["chr"],"align":["left"]},{"label":["result"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"1999","2":"1","3":"ATL","4":"-3"},{"1":"1999","2":"1","3":"CHI","4":"3"},{"1":"1999","2":"1","3":"CLE","4":"-43"},{"1":"1999","2":"1","3":"GB","4":"4"},{"1":"1999","2":"1","3":"IND","4":"17"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Note that we used <code>rename</code> to change <code>home_team</code> to <code>team</code>.</p>
<pre class="r"><code>away &lt;- games %&gt;%
  filter(game_type == &#39;REG&#39;) %&gt;%
  select(season, week, away_team, result) %&gt;%
  rename(team = away_team) %&gt;%
  mutate(result = -result)
away %&gt;% head(5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["season"],"name":[1],"type":["int"],"align":["right"]},{"label":["week"],"name":[2],"type":["int"],"align":["right"]},{"label":["team"],"name":[3],"type":["chr"],"align":["left"]},{"label":["result"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"1999","2":"1","3":"MIN","4":"3"},{"1":"1999","2":"1","3":"KC","4":"-3"},{"1":"1999","2":"1","3":"PIT","4":"43"},{"1":"1999","2":"1","3":"OAK","4":"-4"},{"1":"1999","2":"1","3":"BUF","4":"-17"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>For away teams, we need to flip the result since result is given from the perspective of the home team. Now let’s make a columns called <code>win</code> based on the result.</p>
<pre class="r"><code>results &lt;- bind_rows(home, away) %&gt;%
  arrange(week) %&gt;%
  mutate(
    win = case_when(
      result &gt; 0 ~ 1,
      result &lt; 0 ~ 0,
      result == 0 ~ 0.5
    )
  )
results %&gt;% filter(season == 2019 &amp; team == &#39;SEA&#39;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["season"],"name":[1],"type":["int"],"align":["right"]},{"label":["week"],"name":[2],"type":["int"],"align":["right"]},{"label":["team"],"name":[3],"type":["chr"],"align":["left"]},{"label":["result"],"name":[4],"type":["int"],"align":["right"]},{"label":["win"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"2019","2":"1","3":"SEA","4":"1","5":"1"},{"1":"2019","2":"2","3":"SEA","4":"2","5":"1"},{"1":"2019","2":"3","3":"SEA","4":"-6","5":"0"},{"1":"2019","2":"4","3":"SEA","4":"17","5":"1"},{"1":"2019","2":"5","3":"SEA","4":"1","5":"1"},{"1":"2019","2":"6","3":"SEA","4":"4","5":"1"},{"1":"2019","2":"7","3":"SEA","4":"-14","5":"0"},{"1":"2019","2":"8","3":"SEA","4":"7","5":"1"},{"1":"2019","2":"9","3":"SEA","4":"6","5":"1"},{"1":"2019","2":"10","3":"SEA","4":"3","5":"1"},{"1":"2019","2":"12","3":"SEA","4":"8","5":"1"},{"1":"2019","2":"13","3":"SEA","4":"7","5":"1"},{"1":"2019","2":"14","3":"SEA","4":"-16","5":"0"},{"1":"2019","2":"15","3":"SEA","4":"6","5":"1"},{"1":"2019","2":"16","3":"SEA","4":"-14","5":"0"},{"1":"2019","2":"17","3":"SEA","4":"-5","5":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Doing the <code>results %&gt;% filter(season == 2019 &amp; team == 'SEA')</code> part at the end isn’t actually for saving the data in a new form, but just making sure the previous step did what I wanted. This is a good habit to get into: frequently inspect your data and make sure it looks like you think it should.</p>
<p>Now that we have the dataframe we wanted, we can get team wins by season easily:</p>
<pre class="r"><code>team_wins &lt;- results %&gt;%
  group_by(team, season) %&gt;%
  summarize(
    wins = sum(win),
    point_diff = sum(result)) %&gt;%
  ungroup()

team_wins %&gt;%
  arrange(-wins) %&gt;%
  head(5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["team"],"name":[1],"type":["chr"],"align":["left"]},{"label":["season"],"name":[2],"type":["int"],"align":["right"]},{"label":["wins"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["point_diff"],"name":[4],"type":["int"],"align":["right"]}],"data":[{"1":"NE","2":"2007","3":"16","4":"315"},{"1":"CAR","2":"2015","3":"15","4":"192"},{"1":"GB","2":"2011","3":"15","4":"201"},{"1":"PIT","2":"2004","3":"15","4":"121"},{"1":"BAL","2":"2019","3":"14","4":"249"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Again, we’re making sure the data looks like it “should” by checking the 5 seasons with the most wins, and making sure it looks right.</p>
<p>Now that the team-season win and point differential data is ready, we need to go back to the <code>nflfastR</code> data to get EPA/play.</p>
</div>
<div id="section-get-team-epa-by-season" class="section level3">
<h3>Get team EPA by season</h3>
<p>Let’s start by getting data from every season from the <code>nflfastR</code> data repository:</p>
<pre class="r"><code>seasons &lt;- 1999:2019
pbp &lt;- map_df(seasons, function(x) {
  readRDS(
    url(
      paste0(&quot;https://raw.githubusercontent.com/guga31bb/nflfastR-data/master/data/play_by_play_&quot;,x,&quot;.rds&quot;)
    )
  ) %&gt;%
    filter(rush == 1 | pass == 1, week &lt;= 17, !is.na(epa), !is.na(posteam), posteam != &quot;&quot;) %&gt;%
    select(season, posteam, pass, defteam, epa)
})</code></pre>
<p>I’m being pretty aggressive with dropping rows and columns (<code>filter</code> and <code>select</code>) because otherwise loading this all into memory can be painful on the computer. But this is all we need for what we’re doing. Note that I’m only keeping regular season games here (<code>week &lt;= 17</code>) since this is how this analysis is usually done.</p>
<p>Now we can get EPA/play on offense and defense. Let’s break it out by pass and rush too. I don’t remember how to do some of this so let’s do it in steps. We know we need to group by team, season, and pass, so there’s the beginning:</p>
<pre class="r"><code>pbp %&gt;%
  group_by(posteam, season, pass) %&gt;% 
  summarize(epa = mean(epa)) %&gt;%
  head(4)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["posteam"],"name":[1],"type":["chr"],"align":["left"]},{"label":["season"],"name":[2],"type":["int"],"align":["right"]},{"label":["pass"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["epa"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"ARI","2":"1999","3":"0","4":"-0.20747425"},{"1":"ARI","2":"1999","3":"1","4":"-0.15281949"},{"1":"ARI","2":"2000","3":"0","4":"-0.22911673"},{"1":"ARI","2":"2000","3":"1","4":"-0.07394172"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>But this makes two rows per team-season. How to get each team-season on the same row? <code>pivot_wider</code> is what we need:</p>
<pre class="r"><code>pbp %&gt;%
  group_by(posteam, season, pass) %&gt;% 
  summarize(epa = mean(epa)) %&gt;%
  pivot_wider(names_from = pass, values_from = epa) %&gt;%
  head(4)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["posteam"],"name":[1],"type":["chr"],"align":["left"]},{"label":["season"],"name":[2],"type":["int"],"align":["right"]},{"label":["0"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["1"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"ARI","2":"1999","3":"-0.2074743","4":"-0.15281949"},{"1":"ARI","2":"2000","3":"-0.2291167","4":"-0.07394172"},{"1":"ARI","2":"2001","3":"-0.1758487","4":"0.07453219"},{"1":"ARI","2":"2002","3":"-0.1389968","4":"-0.07144979"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This one is hard to wrap my head around so I usually open up the <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">reference page</a>, read the example, and pray that what I try works. In this case it did. Hooray! This turned our two-lines-per-team dataframe into one, with the 0 column being pass == 0 (run plays) and the 1 column pass == 1.</p>
<p>Now let’s rename to something more sensible and save:</p>
<pre class="r"><code>offense &lt;- pbp %&gt;%
  group_by(posteam, season, pass) %&gt;% 
  summarize(epa = mean(epa)) %&gt;%
  pivot_wider(names_from = pass, values_from = epa) %&gt;%
  rename(off_pass_epa = `1`, off_rush_epa = `0`)</code></pre>
<p>Note that variable names that are numbers need to be surrounded in tick marks for this to work.</p>
<p>Now we can repeat the same process for defense:</p>
<pre class="r"><code>defense &lt;- pbp %&gt;%
  group_by(defteam, season, pass) %&gt;% 
  summarize(epa = mean(epa)) %&gt;%
  pivot_wider(names_from = pass, values_from = epa) %&gt;%
  rename(def_pass_epa = `1`, def_rush_epa = `0`)</code></pre>
<p>Let’s do another sanity check looking at the top 5 pass offenses and defenses:</p>
<pre class="r"><code>#top 5 offenses
offense %&gt;%
  arrange(-off_pass_epa) %&gt;%
  head(5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["posteam"],"name":[1],"type":["chr"],"align":["left"]},{"label":["season"],"name":[2],"type":["int"],"align":["right"]},{"label":["off_rush_epa"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["off_pass_epa"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"NE","2":"2007","3":"0.007529830","4":"0.4238530"},{"1":"IND","2":"2004","3":"-0.004741835","4":"0.4179943"},{"1":"GB","2":"2011","3":"-0.092821801","4":"0.4119035"},{"1":"KC","2":"2018","3":"0.026666888","4":"0.3502082"},{"1":"DEN","2":"2013","3":"-0.021339114","4":"0.3426456"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>#top 5 defenses
defense %&gt;%
  arrange(def_pass_epa) %&gt;%
  head(5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["defteam"],"name":[1],"type":["chr"],"align":["left"]},{"label":["season"],"name":[2],"type":["int"],"align":["right"]},{"label":["def_rush_epa"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["def_pass_epa"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"TB","2":"2002","3":"-0.07596228","4":"-0.2881433"},{"1":"JAX","2":"2017","3":"-0.10634258","4":"-0.2343839"},{"1":"NE","2":"2019","3":"-0.15848627","4":"-0.2303815"},{"1":"NYJ","2":"2009","3":"-0.10052719","4":"-0.2160120"},{"1":"LA","2":"2003","3":"-0.05878346","4":"-0.2090212"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The top pass defenses (2002 TB, 2017 JAX, 2019 NE) and offenses (2007 Pats, 2004 Colts, 2011 Packers) definitely check out!</p>
</div>
<div id="section-fix-team-names-and-join" class="section level3">
<h3>Fix team names and join</h3>
<p>Now we’re ready to bind it all together. Actually, let’s make sure all the team names are ready too.</p>
<pre class="r"><code>team_wins %&gt;%
  group_by(team) %&gt;%
  summarize(n=n()) %&gt;%
  arrange(n)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["team"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"LV","2":"1"},{"1":"LAC","2":"4"},{"1":"LA","2":"5"},{"1":"STL","2":"17"},{"1":"SD","2":"18"},{"1":"HOU","2":"19"},{"1":"OAK","2":"21"},{"1":"ARI","2":"22"},{"1":"ATL","2":"22"},{"1":"BAL","2":"22"},{"1":"BUF","2":"22"},{"1":"CAR","2":"22"},{"1":"CHI","2":"22"},{"1":"CIN","2":"22"},{"1":"CLE","2":"22"},{"1":"DAL","2":"22"},{"1":"DEN","2":"22"},{"1":"DET","2":"22"},{"1":"GB","2":"22"},{"1":"IND","2":"22"},{"1":"JAX","2":"22"},{"1":"KC","2":"22"},{"1":"MIA","2":"22"},{"1":"MIN","2":"22"},{"1":"NE","2":"22"},{"1":"NO","2":"22"},{"1":"NYG","2":"22"},{"1":"NYJ","2":"22"},{"1":"PHI","2":"22"},{"1":"PIT","2":"22"},{"1":"SEA","2":"22"},{"1":"SF","2":"22"},{"1":"TB","2":"22"},{"1":"TEN","2":"22"},{"1":"WAS","2":"22"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Nope, not yet, we need to fix the Raiders, Rams, and Chargers, which are LV, LA, and LAC in <code>nflfastR</code>.</p>
<pre class="r"><code>team_wins &lt;- team_wins %&gt;%
  mutate(
    team = case_when(
      team == &#39;OAK&#39; ~ &#39;LV&#39;,
      team == &#39;SD&#39; ~ &#39;LAC&#39;,
      team == &#39;STL&#39; ~ &#39;LA&#39;,
      TRUE ~ team
    )
  )</code></pre>
<p>The <code>TRUE</code> statement at the bottom says that if none of the above cases are found, keep team the same. Let’s make sure this worked:</p>
<pre class="r"><code>team_wins %&gt;%
  group_by(team) %&gt;%
  summarize(n=n()) %&gt;%
  arrange(n)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["team"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"HOU","2":"19"},{"1":"ARI","2":"22"},{"1":"ATL","2":"22"},{"1":"BAL","2":"22"},{"1":"BUF","2":"22"},{"1":"CAR","2":"22"},{"1":"CHI","2":"22"},{"1":"CIN","2":"22"},{"1":"CLE","2":"22"},{"1":"DAL","2":"22"},{"1":"DEN","2":"22"},{"1":"DET","2":"22"},{"1":"GB","2":"22"},{"1":"IND","2":"22"},{"1":"JAX","2":"22"},{"1":"KC","2":"22"},{"1":"LA","2":"22"},{"1":"LAC","2":"22"},{"1":"LV","2":"22"},{"1":"MIA","2":"22"},{"1":"MIN","2":"22"},{"1":"NE","2":"22"},{"1":"NO","2":"22"},{"1":"NYG","2":"22"},{"1":"NYJ","2":"22"},{"1":"PHI","2":"22"},{"1":"PIT","2":"22"},{"1":"SEA","2":"22"},{"1":"SF","2":"22"},{"1":"TB","2":"22"},{"1":"TEN","2":"22"},{"1":"WAS","2":"22"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>HOU has 3 fewer seasons because it didn’t exist from 1999 through 2001, which is fine, and all the other team names have 22 seasons like they should. Okay NOW we can join:</p>
<pre class="r"><code>data &lt;- team_wins %&gt;%
  left_join(offense, by = c(&#39;team&#39; = &#39;posteam&#39;, &#39;season&#39;)) %&gt;%
  left_join(defense, by = c(&#39;team&#39; = &#39;defteam&#39;, &#39;season&#39;))
data %&gt;%
  filter(team == &#39;SEA&#39; &amp; season &gt;= 2012)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["team"],"name":[1],"type":["chr"],"align":["left"]},{"label":["season"],"name":[2],"type":["int"],"align":["right"]},{"label":["wins"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["point_diff"],"name":[4],"type":["int"],"align":["right"]},{"label":["off_rush_epa"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["off_pass_epa"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["def_rush_epa"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["def_pass_epa"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"SEA","2":"2012","3":"11.0","4":"167","5":"-0.001362079","6":"0.21674234","7":"-0.06694352","8":"-0.031324541"},{"1":"SEA","2":"2013","3":"13.0","4":"186","5":"-0.092815046","6":"0.18463707","7":"-0.12249106","8":"-0.152704094"},{"1":"SEA","2":"2014","3":"12.0","4":"140","5":"0.029225155","6":"0.14471102","7":"-0.21821591","8":"-0.025739411"},{"1":"SEA","2":"2015","3":"10.0","4":"146","5":"-0.087933749","6":"0.24327159","7":"-0.13808183","8":"-0.037092805"},{"1":"SEA","2":"2016","3":"10.5","4":"62","5":"-0.114779669","6":"0.10598001","7":"-0.19224113","8":"0.062152735"},{"1":"SEA","2":"2017","3":"9.0","4":"34","5":"-0.175644635","6":"0.06585462","7":"-0.11639661","8":"-0.003397953"},{"1":"SEA","2":"2018","3":"10.0","4":"81","5":"-0.019649533","6":"0.22225449","7":"-0.11836473","8":"0.078534637"},{"1":"SEA","2":"2019","3":"11.0","4":"7","5":"-0.116900761","6":"0.12082751","7":"-0.08772299","8":"0.084644637"},{"1":"SEA","2":"2020","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now we’re getting really close to doing what we want! Next we need to create new columns for prior year EPA, and let’s do point differential too.</p>
<pre class="r"><code>data &lt;- data %&gt;% 
  arrange(team, season) %&gt;%
  mutate(
    prior_off_rush_epa = lag(off_rush_epa),
    prior_off_pass_epa = lag(off_pass_epa),
    prior_def_rush_epa = lag(def_rush_epa),
    prior_def_pass_epa = lag(def_pass_epa),
    prior_point_diff = lag(point_diff)
  )
data %&gt;%
  head(5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["team"],"name":[1],"type":["chr"],"align":["left"]},{"label":["season"],"name":[2],"type":["int"],"align":["right"]},{"label":["wins"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["point_diff"],"name":[4],"type":["int"],"align":["right"]},{"label":["off_rush_epa"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["off_pass_epa"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["def_rush_epa"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["def_pass_epa"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["prior_off_rush_epa"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["prior_off_pass_epa"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["prior_def_rush_epa"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["prior_def_pass_epa"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["prior_point_diff"],"name":[13],"type":["int"],"align":["right"]}],"data":[{"1":"ARI","2":"1999","3":"6","4":"-137","5":"-0.2074743","6":"-0.15281949","7":"-0.0009263207","8":"0.002798224","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA"},{"1":"ARI","2":"2000","3":"3","4":"-233","5":"-0.2291167","6":"-0.07394172","7":"0.0384432207","8":"0.181900799","9":"-0.2074743","10":"-0.15281949","11":"-0.0009263207","12":"0.002798224","13":"-137"},{"1":"ARI","2":"2001","3":"7","4":"-48","5":"-0.1758487","6":"0.07453219","7":"-0.0489322940","8":"0.070471954","9":"-0.2291167","10":"-0.07394172","11":"0.0384432207","12":"0.181900799","13":"-233"},{"1":"ARI","2":"2002","3":"5","4":"-155","5":"-0.1389968","6":"-0.07144979","7":"-0.0087004301","8":"0.164149767","9":"-0.1758487","10":"0.07453219","11":"-0.0489322940","12":"0.070471954","13":"-48"},{"1":"ARI","2":"2003","3":"4","4":"-227","5":"-0.2279873","6":"-0.11715502","7":"-0.0497225638","8":"0.189709137","9":"-0.1389968","10":"-0.07144979","11":"-0.0087004301","12":"0.164149767","13":"-155"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Finally! Now we have the data in place and can start doing things with it.</p>
</div>
<div id="section-correlations-and-regressions" class="section level3">
<h3>Correlations and regressions</h3>
<pre class="r"><code>data %&gt;% 
  select(-team, -season) %&gt;%
  cor(use=&quot;complete.obs&quot;) %&gt;%
  round(2)
#&gt;                     wins point_diff off_rush_epa off_pass_epa def_rush_epa
#&gt; wins                1.00       0.92         0.45         0.69        -0.30
#&gt; point_diff          0.92       1.00         0.50         0.75        -0.34
#&gt; off_rush_epa        0.45       0.50         1.00         0.41         0.03
#&gt; off_pass_epa        0.69       0.75         0.41         1.00        -0.02
#&gt; def_rush_epa       -0.30      -0.34         0.03        -0.02         1.00
#&gt; def_pass_epa       -0.56      -0.61        -0.04        -0.08         0.31
#&gt; prior_off_rush_epa  0.24       0.27         0.33         0.22         0.00
#&gt; prior_off_pass_epa  0.28       0.32         0.19         0.47         0.00
#&gt; prior_def_rush_epa -0.12      -0.14         0.02        -0.04         0.26
#&gt; prior_def_pass_epa -0.17      -0.20        -0.07        -0.04         0.06
#&gt; prior_point_diff    0.36       0.41         0.22         0.36        -0.09
#&gt;                    def_pass_epa prior_off_rush_epa prior_off_pass_epa
#&gt; wins                      -0.56               0.24               0.28
#&gt; point_diff                -0.61               0.27               0.32
#&gt; off_rush_epa              -0.04               0.33               0.19
#&gt; off_pass_epa              -0.08               0.22               0.47
#&gt; def_rush_epa               0.31               0.00               0.00
#&gt; def_pass_epa               1.00              -0.10               0.01
#&gt; prior_off_rush_epa        -0.10               1.00               0.42
#&gt; prior_off_pass_epa         0.01               0.42               1.00
#&gt; prior_def_rush_epa         0.15               0.03              -0.02
#&gt; prior_def_pass_epa         0.28              -0.01              -0.07
#&gt; prior_point_diff          -0.19               0.49               0.75
#&gt;                    prior_def_rush_epa prior_def_pass_epa prior_point_diff
#&gt; wins                            -0.12              -0.17             0.36
#&gt; point_diff                      -0.14              -0.20             0.41
#&gt; off_rush_epa                     0.02              -0.07             0.22
#&gt; off_pass_epa                    -0.04              -0.04             0.36
#&gt; def_rush_epa                     0.26               0.06            -0.09
#&gt; def_pass_epa                     0.15               0.28            -0.19
#&gt; prior_off_rush_epa               0.03              -0.01             0.49
#&gt; prior_off_pass_epa              -0.02              -0.07             0.75
#&gt; prior_def_rush_epa               1.00               0.32            -0.36
#&gt; prior_def_pass_epa               0.32               1.00            -0.59
#&gt; prior_point_diff                -0.36              -0.59             1.00</code></pre>
<p>We’ve covered <code>select</code>, but here we see a new use where a minus sign de-selects variables (we need to de-select team name for correlation to work because it doesn’t work for character strings, and correlation with the season number itself is meaningless). We’ve run the correlation on this dataframe, removing missing values, and then rounding to 2 digits. Not surprisingly, we see that wins in the current season are more strongly related to passing offense EPA than rushing EPA or defense EPA, and prior offense carries more predictive power than prior defense. Pass offense is more stable year to year (0.47) than rush offense (0.33), pass defense (0.28), or rush defense (0.26).</p>
<p>I’m actually surprised that the values for passing offense aren’t higher relative to the others. Maybe it was because most of our prior results come from the <code>nflscrapR</code> era (2009 - 2019)? Let’s check what this looks like since 2009 relative to earlier seasons:</p>
<pre class="r"><code>message(&quot;2009 through 2019&quot;)
#&gt; 2009 through 2019
data %&gt;% 
  filter(season &gt;= 2009) %&gt;%
  select(wins, point_diff, off_pass_epa, off_rush_epa, prior_point_diff, prior_off_pass_epa, prior_off_rush_epa) %&gt;%
  cor(use=&quot;complete.obs&quot;) %&gt;%
  round(2)
#&gt;                    wins point_diff off_pass_epa off_rush_epa prior_point_diff
#&gt; wins               1.00       0.91         0.72         0.42             0.43
#&gt; point_diff         0.91       1.00         0.79         0.48             0.44
#&gt; off_pass_epa       0.72       0.79         1.00         0.39             0.39
#&gt; off_rush_epa       0.42       0.48         0.39         1.00             0.19
#&gt; prior_point_diff   0.43       0.44         0.39         0.19             1.00
#&gt; prior_off_pass_epa 0.34       0.36         0.46         0.11             0.78
#&gt; prior_off_rush_epa 0.25       0.25         0.16         0.24             0.47
#&gt;                    prior_off_pass_epa prior_off_rush_epa
#&gt; wins                             0.34               0.25
#&gt; point_diff                       0.36               0.25
#&gt; off_pass_epa                     0.46               0.16
#&gt; off_rush_epa                     0.11               0.24
#&gt; prior_point_diff                 0.78               0.47
#&gt; prior_off_pass_epa               1.00               0.37
#&gt; prior_off_rush_epa               0.37               1.00</code></pre>
<pre class="r"><code>message(&quot;1999 through 2008&quot;)
#&gt; 1999 through 2008
data %&gt;% 
  filter(season &lt; 2009) %&gt;%
  select(wins, point_diff, off_pass_epa, off_rush_epa, prior_point_diff, prior_off_pass_epa, prior_off_rush_epa) %&gt;%
  cor(use=&quot;complete.obs&quot;) %&gt;%
  round(2)
#&gt;                    wins point_diff off_pass_epa off_rush_epa prior_point_diff
#&gt; wins               1.00       0.92         0.67         0.48             0.28
#&gt; point_diff         0.92       1.00         0.72         0.52             0.36
#&gt; off_pass_epa       0.67       0.72         1.00         0.49             0.34
#&gt; off_rush_epa       0.48       0.52         0.49         1.00             0.27
#&gt; prior_point_diff   0.28       0.36         0.34         0.27             1.00
#&gt; prior_off_pass_epa 0.22       0.28         0.45         0.31             0.74
#&gt; prior_off_rush_epa 0.23       0.29         0.30         0.43             0.51
#&gt;                    prior_off_pass_epa prior_off_rush_epa
#&gt; wins                             0.22               0.23
#&gt; point_diff                       0.28               0.29
#&gt; off_pass_epa                     0.45               0.30
#&gt; off_rush_epa                     0.31               0.43
#&gt; prior_point_diff                 0.74               0.51
#&gt; prior_off_pass_epa               1.00               0.49
#&gt; prior_off_rush_epa               0.49               1.00</code></pre>
<p>Yep, that seems to be the case. So in the more recent period, passing offense has become slightly more stable (from 0.45 to 0.46) but more predictive of following-year success (from 0.67 to 0.72), while at the same time rushing offense has become substantially less stable (from 0.43 to 0.24) and less predictive of future team success (from 0.48 to 0.42).</p>
<p>Now let’s do a basic regression of wins on prior offense and defense EPA/play. Maybe we should only look at this more recent period to fit our model since it’s more relevant for 2020. In the real world, we would be more rigorous about making decisions like this, but let’s proceed anyway.</p>
<pre class="r"><code>data &lt;- data %&gt;% filter(season &gt;= 2009)
fit &lt;- lm(wins ~ prior_off_pass_epa  + prior_off_rush_epa + prior_def_pass_epa + prior_def_rush_epa, data = data)
summary(fit)
#&gt; 
#&gt; Call:
#&gt; lm(formula = wins ~ prior_off_pass_epa + prior_off_rush_epa + 
#&gt;     prior_def_pass_epa + prior_def_rush_epa, data = data)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -7.6973 -1.8501  0.0695  2.1627  7.1230 
#&gt; 
#&gt; Coefficients:
#&gt;                    Estimate Std. Error t value             Pr(&gt;|t|)    
#&gt; (Intercept)          7.9383     0.3898  20.367 &lt; 0.0000000000000002 ***
#&gt; prior_off_pass_epa   6.4582     1.3096   4.931           0.00000127 ***
#&gt; prior_off_rush_epa   6.4288     2.3552   2.730              0.00666 ** 
#&gt; prior_def_pass_epa  -3.8505     1.7409  -2.212              0.02763 *  
#&gt; prior_def_rush_epa  -5.6343     2.4438  -2.306              0.02172 *  
#&gt; ---
#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
#&gt; 
#&gt; Residual standard error: 2.825 on 347 degrees of freedom
#&gt;   (32 observations deleted due to missingness)
#&gt; Multiple R-squared:  0.167,  Adjusted R-squared:  0.1574 
#&gt; F-statistic: 17.39 on 4 and 347 DF,  p-value: 0.0000000000005126</code></pre>
<p>I’m actually pretty surprised passing offense isn’t higher here. How does this compare to simply using point differential?</p>
<pre class="r"><code>fit2 &lt;- lm(wins ~ prior_point_diff, data = data)
summary(fit2)
#&gt; 
#&gt; Call:
#&gt; lm(formula = wins ~ prior_point_diff, data = data)
#&gt; 
#&gt; Residuals:
#&gt;     Min      1Q  Median      3Q     Max 
#&gt; -7.1042 -1.8347  0.1688  2.0713  7.4547 
#&gt; 
#&gt; Coefficients:
#&gt;                  Estimate Std. Error t value            Pr(&gt;|t|)    
#&gt; (Intercept)      8.000000   0.148515  53.867 &lt;0.0000000000000002 ***
#&gt; prior_point_diff 0.012990   0.001468   8.847 &lt;0.0000000000000002 ***
#&gt; ---
#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
#&gt; 
#&gt; Residual standard error: 2.786 on 350 degrees of freedom
#&gt;   (32 observations deleted due to missingness)
#&gt; Multiple R-squared:  0.1827, Adjusted R-squared:  0.1804 
#&gt; F-statistic: 78.26 on 1 and 350 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<p>So R2 is somewhat higher for just point differential. This isn’t surprising as we’ve thrown away special teams plays and haven’t attempted to make any adjustments for things like fumble luck that we know can improve EPA’s predictive power.</p>
</div>
<div id="section-predictions" class="section level3">
<h3>Predictions</h3>
<p>Now let’s get the predictions from the EPA model:</p>
<pre class="r"><code>preds &lt;- predict(fit, data %&gt;% filter(season == 2020)) %&gt;%
  #was just a vector, need a tibble to bind
  as_tibble() %&gt;%
  #make the column name make sense
  rename(prediction = value) %&gt;%
  round(1) %&gt;%
  #get names
  bind_cols(
    data %&gt;% filter(season == 2020) %&gt;% select(team)
  )

preds %&gt;%
  arrange(-prediction) %&gt;%
  head(5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["prediction"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["team"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"11.4","2":"BAL"},{"1":"10.1","2":"SF"},{"1":"9.7","2":"NE"},{"1":"9.7","2":"NO"},{"1":"9.6","2":"DAL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This mostly checks out.</p>
<p>What if we just used simple point differential to predict?</p>
<pre class="r"><code>preds2 &lt;- predict(fit2, data %&gt;% filter(season == 2020)) %&gt;%
  #was just a vector, need a tibble to bind
  as_tibble() %&gt;%
  #make the column name make sense
  rename(prediction = value) %&gt;%
  round(1) %&gt;%
  #get names
  bind_cols(
    data %&gt;% filter(season == 2020) %&gt;% select(team)
  )
preds2 %&gt;%
  arrange(-prediction) %&gt;%
  head(5)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["prediction"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["team"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"11.2","2":"BAL"},{"1":"10.5","2":"NE"},{"1":"10.2","2":"SF"},{"1":"9.9","2":"KC"},{"1":"9.5","2":"DAL"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Not surprisingly, this looks pretty similar. These are very basic models that don’t incorporate schedule, roster changes, etc. For example, a better model would take into account Tom Brady no longer playing for the Patriots. But hopefully this has been useful!</p>
</div>
</div>
<div id="section-next-steps" class="section level2">
<h2>Next Steps</h2>
<p>You now should know enough to be able to tackle a great deal of questions using <code>nflfastR</code> data. A good way to build up skills is to take interesting things you see and try to replicate them (for making figures, this will also involve a heavy dose of googling stuff).</p>
<p>Looking at others’ code is also a good way to learn. One option is to look through the <code>nflfastR</code> code base, much of which you should now understand what it’s doing. For example, <a href="https://github.com/mrcaseb/nflfastR/blob/master/R/helper_add_nflscrapr_mutations.R">here is the function that cleans up the data and prepares it for later stages</a>: there’s a heavy dose of <code>mutate</code>, <code>group_by</code>, <code>arrange</code>, <code>lag</code>, <code>if_else</code>, and <code>case_when</code>.</p>
<div id="section-other-code-examples-r" class="section level3">
<h3>Other code examples: R</h3>
<ul>
<li><a href="https://r4ds.had.co.nz/explore-intro.html">Introduction to R (<strong>recommended</strong>)</a></li>
<li><a href="https://github.com/leesharpe/nfldata/blob/master/RSTUDIO-INTRO.md">Lee Sharpe: basic intro to R and RStudio</a></li>
<li><a href="https://github.com/leesharpe/nfldata">Lee Sharpe: lots of useful NFL / nflscrapR code</a></li>
<li><a href="https://github.com/leesharpe/nfldata/blob/master/UPDATING-NFLSCRAPR.md">Lee Sharpe: how to update current season games</a></li>
<li><a href="https://jthomasmock.github.io/nfl_plotting_cookbook/">Thomas Mock: pretty #viz with nflscrapR</a></li>
<li><a href="https://gist.github.com/jthomasmock/7d489f04e53812eacca8b94b6c8ee84a">Thomas Mock: biggest comebacks</a></li>
<li><a href="https://t.co/gxDDhOYhcI">Josh Hermsmeyer: Getting Started with R for NFL Analysis</a></li>
<li><a href="https://slavin22.github.io/SFB9-Positional-Tiers/Guide.nb">Slavin: visualizing positional tiers in SFB9</a></li>
<li><a href="https://github.com/ryurko/nflscrapR-data/tree/master/R">Ron Yurko: assorted examples</a></li>
<li><a href="https://github.com/dhouston890/cowboys-stats/blob/master/playmaking_epa_pbp.R">CowboysStats: defensive playmaking EPA</a></li>
<li><a href="https://github.com/statsbylopez/BlogPosts/blob/master/scrapr-data.R">Michael Lopez: function to sample plays</a></li>
<li><a href="https://statsbylopez.netlify.com/post/r-for-nfl-analysis/">Michael Lopez: R for NFL analysis (presentation to club staffers)</a></li>
<li><a href="https://gist.github.com/wessonmo/45781bd25a74e8097e0c8bc8fbacf796">Mitchell Wesson: QB hits investigation</a></li>
<li><a href="https://gist.github.com/wessonmo/ef44ea9873d70f816454cb88b86dcce6">Mitchell Wesson: Investigation of the nflscrapR EP model</a></li>
<li><a href="https://github.com/whoffman21279/Steelers/blob/master/receiving_stats">WHoffman: graphs for receivers (aDoT, success rate, and more)</a></li>
<li><a href="https://gist.github.com/ChiBearsStats/dac3266037797032a23f38fd9d64d6a8#file-adjustedthirddowns-txt">ChiBearsStats: investigation of 3rd downs vs offensive efficiency</a></li>
<li><a href="https://gist.github.com/ChiBearsStats/78e33baeed3cd6d3cac0040b47d4ec69">ChiBearsStats: the insignificance of field goal kicking</a></li>
</ul>
</div>
<div id="section-more-data-sources" class="section level3">
<h3>More data sources</h3>
<ul>
<li><a href="https://github.com/leesharpe/nfldata/blob/master/DATASETS.md">Lee Sharpe: Draft Picks, Draft Values, Games, Logos, Rosters, Standings</a></li>
<li><a href="https://github.com/greerre/pfr_metadata_pull">greerre: how to get .csv file of weather &amp; stadium data from PFR in python</a></li>
<li><a href="https://gist.github.com/spfleming/2527a6ca2b940af2a8aa1fee9320171d">Parker Fleming: Introduction to College Football Data with R and cfbscrapR</a></li>
</ul>
</div>
<div id="section-other-code-examples-python" class="section level3">
<h3>Other code examples: Python</h3>
<ul>
<li><a href="https://gist.github.com/Deryck97/dff8d33e9f841568201a2a0d5519ac5e">Deryck97: nflscrapR Python Guide</a></li>
<li><a href="https://github.com/jezlax/sports_analytics/blob/master/animated_nfl_scatter.py">Cory Jez: animated plot</a></li>
<li><a href="https://gist.github.com/903124/6693fdf6b991437a6d6ef9c5d935c83b">903124S: Sampling EP</a></li>
<li><a href="https://gist.github.com/903124/d304f76688b0699497a35b61b6d1e267">903124S: estimating EPA using nfldb</a></li>
<li><a href="https://gist.github.com/903124/3c6f0dc0a100d78b8622573ef4c504f5">903124S: estimate EPA for college football</a></li>
<li>Blake Atkinson: explosiveness <a href="https://medium.com/@BlakeAtkinson/the-2018-kansas-city-chiefs-and-an-explosiveness-metric-in-football-c3b3fd447d73">blog post</a> and <a href="https://github.com/btatkinson/yard_value/blob/master/yard_value.ipynb">python code</a></li>
<li>Blake Atkinson: player type visualizations <a href="https://medium.com/@BlakeAtkinson/visualizing-different-nfl-player-styles-88ef31420539">blog post</a> and <a href="https://github.com/btatkinson/player_vectors/blob/master/player_vectors.ipynb">python code</a> 
<script type="application/shiny-prerendered" data-context="server-start">
  knitr::opts_chunk$set(collapse = TRUE,  out.width = "100%",   comment = "#>")
</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/cerulean.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["pagedtable"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pagedtable-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/pagedtable.js"]},{"type":"character","attributes":{},"value":["css/pagedtable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["textmate.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-autocompletion"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-autocompletion.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-diagnostics"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-diagnostics.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-format"]},{"type":"character","attributes":{},"value":["0.10.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmarkdown/templates/tutorial/resources"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-format.js"]},{"type":"character","attributes":{},"value":["tutorial-format.css","rstudio-theme.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["0.10.1"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.2"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.2"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106]}},"value":[{"type":"character","attributes":{},"value":["assertthat","backports","base","BiocManager","blob","broom","callr","cellranger","cli","colorspace","compiler","crayon","curl","datasets","DBI","dbplyr","desc","devtools","digest","dplyr","ellipsis","evaluate","fansi","farver","fastmap","forcats","fs","generics","ggimage","ggplot2","ggplotify","ggrepel","glue","graphics","grDevices","grid","gridGraphics","gtable","haven","hms","htmltools","htmlwidgets","httpuv","httr","jsonlite","knitr","labeling","later","lattice","learnr","lifecycle","lubridate","magick","magrittr","markdown","Matrix","memoise","methods","mgcv","mime","modelr","munsell","nflfastR","nlme","pillar","pkgbuild","pkgconfig","pkgload","prettyunits","processx","promises","ps","purrr","R6","Rcpp","readr","readxl","remotes","reprex","rlang","rmarkdown","rprojroot","rstudioapi","rvcheck","rvest","scales","sessioninfo","shiny","splines","stats","stringi","stringr","testthat","tibble","tidyr","tidyselect","tidyverse","tools","usethis","utils","vctrs","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["0.2.1","1.1.7","3.6.3","1.30.10","1.2.1","0.5.6","3.4.3","1.1.0","2.0.2","1.4-1","3.6.3","1.3.4","4.3","3.6.3","1.1.0","1.4.4","1.2.0","2.3.0","0.6.25","1.0.0","0.3.1","0.14","0.4.1","2.0.3","1.0.1","0.5.0","1.4.1","0.0.2","0.2.8","3.3.1","0.0.5","0.8.2","1.4.1","3.6.3","3.6.3","3.6.3","0.5-0","0.3.0","2.3.1","0.5.3","0.4.0","1.5.1","1.5.4","1.4.1","1.6.1","1.28","0.3","1.1.0.1","0.20-41","0.10.1","0.2.0","1.7.9","2.3","1.5","1.1","1.2-18","1.1.0","3.6.3","1.8-31","0.9","0.1.8","0.5.0","2.0.3","3.1-148","1.4.4","1.0.8","2.0.3","1.1.0","1.1.1","3.4.2","1.1.1","1.3.3","0.3.4","2.4.1","1.0.4.6","1.3.1","1.3.1","2.1.1","0.3.0","0.4.6","2.2","1.3-2","0.11","0.1.8","0.3.5","1.1.1","1.1.1","1.4.0.2","3.6.3","3.6.3","1.4.6","1.4.0","2.3.2","3.0.1","1.1.0","1.1.0","1.3.0","3.6.3","1.6.1","3.6.3","0.3.1","2.2.0","0.14","1.3.2","1.8-4","2.2.1"]}]}]}
</script>
<!--/html_preserve--></li>
</ul>
</div>
</div>

</div> <!-- topics -->

<div class="topicsContainer">
<div class="topicsPositioner">
<div class="band">
<div class="bandContent topicsListContainer">

<!-- begin doc-metadata -->
<div id="doc-metadata">
<h2 class="title toc-ignore" style="display:none;">Beginner’s Guide to nflfastR</h2>
<h4 class="author"><em>Ben Baldwin (learnr by Tan Ho)</em></h4>
<h4 class="date"><em>20/06/2020</em></h4>
</div>
<!-- end doc-metadata -->

</div> <!-- bandContent.topicsListContainer -->
</div> <!-- band -->
</div> <!-- topicsPositioner -->
</div> <!-- topicsContainer -->


</div> <!-- bandContent page -->
</div> <!-- pageContent band -->




<script>
// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>


</body>

</html>
